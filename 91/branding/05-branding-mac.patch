# HG changeset patch
# Parent  ec442103fa79f559ff8d5068f45324af2d659896
# User Betterbird <betterbird@betterbird.eu>
Branding: Additional makefile changes for Mac, icons still missing.

diff -r ec442103fa79 mail/app/Makefile.in
--- a/mail/app/Makefile.in	Tue Mar 29 22:21:59 2022 +0200
+++ b/mail/app/Makefile.in	Mon Apr 04 15:18:22 2022 +0200
@@ -32,10 +32,10 @@
 
 include $(moztopsrcdir)/config/rules.mk
 
+BINARY = betterbird
 ifneq ($(OS_ARCH),WINNT)
 ifdef COMPILE_ENVIRONMENT
 ifndef MOZ_NO_PIE_COMPAT
-BINARY = betterbird
 libs::
 	cp -p $(DIST)/bin/$(BINARY)$(BIN_SUFFIX) $(DIST)/bin/$(BINARY)-bin$(BIN_SUFFIX)
 endif
@@ -98,24 +98,24 @@
 MAC_BUNDLE_VERSION = $(shell $(PYTHON3) $(srcdir)/macversion.py --version=$(MOZ_APP_VERSION) --buildid=$(DEPTH)/buildid.h)
 
 .PHONY: repackage
-tools repackage:: $(DIST)/bin/$(MOZ_APP_NAME) $(objdir)/macbuild/Contents/MacOS-files.txt
+tools repackage:: $(DIST)/bin/$(BINARY) $(objdir)/macbuild/Contents/MacOS-files.txt
 	rm -rf $(dist_dest)
 	$(MKDIR) -p '$(dist_dest)/Contents/MacOS'
 	$(MKDIR) -p '$(dist_dest)/$(LPROJ)'
 	rsync -a --exclude '*.in' $(srcdir)/macbuild/Contents '$(dist_dest)' --exclude English.lproj
 	rsync -a --exclude '*.in' $(srcdir)/macbuild/Contents/Resources/English.lproj/ '$(dist_dest)/$(LPROJ)'
-	$(call py_action,preprocessor,-Fsubstitution -DAPP_VERSION='$(MOZ_APP_VERSION)' -DMOZ_APP_NAME='$(MOZ_APP_NAME)' -DMAC_APP_NAME='$(MAC_APP_NAME)' -DMOZ_MACBUNDLE_ID='$(MOZ_MACBUNDLE_ID)' -DMAC_BUNDLE_VERSION='$(MAC_BUNDLE_VERSION)' -DMOZ_DEVELOPER_REPO_PATH='$(topsrcdir)' -DMOZ_DEVELOPER_OBJ_PATH='$(topobjdir)' $(srcdir)/macbuild/Contents/Info.plist.in -o '$(dist_dest)/Contents/Info.plist')
+	$(call py_action,preprocessor,-Fsubstitution -DAPP_VERSION='$(MOZ_APP_VERSION)' -DMOZ_APP_NAME='$(BINARY)' -DMAC_APP_NAME='$(MAC_APP_NAME)' -DMOZ_MACBUNDLE_ID='$(MOZ_MACBUNDLE_ID)' -DMAC_BUNDLE_VERSION='$(MAC_BUNDLE_VERSION)' -DMOZ_DEVELOPER_REPO_PATH='$(topsrcdir)' -DMOZ_DEVELOPER_OBJ_PATH='$(topobjdir)' $(srcdir)/macbuild/Contents/Info.plist.in -o '$(dist_dest)/Contents/Info.plist')
 	$(call py_action,preprocessor,-Fsubstitution --output-encoding utf-16 -DMAC_APP_NAME='$(MAC_APP_NAME)' $(srcdir)/macbuild/Contents/Resources/English.lproj/InfoPlist.strings.in -o '$(dist_dest)/$(LPROJ)/InfoPlist.strings')
 	rsync -a --exclude-from='$(objdir)/macbuild/Contents/MacOS-files.txt' $(DIST)/bin/ '$(dist_dest)/Contents/Resources'
 	rsync -a --include-from='$(objdir)/macbuild/Contents/MacOS-files.txt' --exclude '*' $(DIST)/bin/ '$(dist_dest)/Contents/MacOS'
 	# MacOS-files-copy.in is a list of files that should be copies rather
 	# than symlinks and placed in .app/Contents/MacOS.
 	rsync -aL --include-from='$(srcdir)/macbuild/Contents/MacOS-files-copy.in' --exclude '*' $(DIST)/bin/ '$(dist_dest)/Contents/MacOS'
-	$(RM) '$(dist_dest)/Contents/MacOS/$(MOZ_APP_NAME)'
-	rsync -aL $(DIST)/bin/$(MOZ_APP_NAME) '$(dist_dest)/Contents/MacOS'
+	$(RM) '$(dist_dest)/Contents/MacOS/$(BINARY)'
+	rsync -aL $(DIST)/bin/$(BINARY) '$(dist_dest)/Contents/MacOS'
 	$(MKDIR) -p '$(dist_dest)/Contents/Library/Spotlight'
 	rsync -a --copy-unsafe-links $(DIST)/package/thunderbird.mdimporter '$(dist_dest)/Contents/Library/Spotlight'
-	cp -RL $(topsrcdir)/$(MOZ_BRANDING_DIRECTORY)/thunderbird.icns '$(dist_dest)/Contents/Resources/thunderbird.icns'
+	# cp -RL $(topsrcdir)/$(MOZ_BRANDING_DIRECTORY)/thunderbird.icns '$(dist_dest)/Contents/Resources/thunderbird.icns'
 	$(MKDIR) -p '$(dist_dest)/Contents/Library/LaunchServices'
 ifdef MOZ_UPDATER
 	mv -f '$(dist_dest)/Contents/MacOS/updater.app/Contents/MacOS/org.mozilla.updater' '$(dist_dest)/Contents/Library/LaunchServices'
