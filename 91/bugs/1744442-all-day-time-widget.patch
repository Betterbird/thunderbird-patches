# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1638909700 -3600
# Parent  ced787a17a1920d9d2a68a7b38556f6a970fc6fe
Bug 1744442 - Fix non-disabled time widgets for all day events, use setAttribute() instead of toggleAttribute().

diff --git a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js
--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js
+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js
@@ -242,18 +242,18 @@ var dateTimePickerUI = {
     this.end.value = cal.dtz.dateTimeToJsDate(value.getInTimezone(cal.dtz.floating));
   },
   get endValueForDisplay() {
     return this.endValue.getInTimezone(cal.dtz.defaultTimezone);
   },
 
   changeAllDay() {
     let allDay = this.allDay.checked;
-    document.getElementById("event-starttime").toggleAttribute("timepickerdisabled", allDay);
-    document.getElementById("event-endtime").toggleAttribute("timepickerdisabled", allDay);
+    document.getElementById("event-starttime").setAttribute("timepickerdisabled", allDay);
+    document.getElementById("event-endtime").setAttribute("timepickerdisabled", allDay);
 
     if (allDay) {
       // Store date-times and related timezones so we can restore
       // if the user unchecks the "all day" checkbox.
       this.start._oldValue = new Date(this.start.value);
       this.end._oldValue = new Date(this.end.value);
 
       let { startValue, endValue } = this;
diff --git a/calendar/base/content/item-editing/calendar-item-iframe.js b/calendar/base/content/item-editing/calendar-item-iframe.js
--- a/calendar/base/content/item-editing/calendar-item-iframe.js
+++ b/calendar/base/content/item-editing/calendar-item-iframe.js
@@ -1847,18 +1847,18 @@ function updateAllDay() {
     return;
   }
 
   if (!window.calendarItem.isEvent()) {
     return;
   }
 
   let allDay = document.getElementById("event-all-day").checked;
-  document.getElementById("event-starttime").toggleAttribute("timepickerdisabled", allDay);
-  document.getElementById("event-endtime").toggleAttribute("timepickerdisabled", allDay);
+  document.getElementById("event-starttime").setAttribute("timepickerdisabled", allDay);
+  document.getElementById("event-endtime").setAttribute("timepickerdisabled", allDay);
 
   gStartTime.isDate = allDay;
   gEndTime.isDate = allDay;
   gItemDuration = gEndTime.subtractDate(gStartTime);
 
   updateDateTime();
   updateUntildateRecRule();
   updateRepeatDetails();
