# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Parent  62e538a250a764817bb2a070cf9e9245de930616
Bug 1751160 - Remove damaging second notification for news.

diff --git a/mailnews/news/src/nsNNTPNewsgroupList.cpp b/mailnews/news/src/nsNNTPNewsgroupList.cpp
--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp
+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp
@@ -1019,26 +1019,21 @@ nsresult nsNNTPNewsgroupList::CallFilter
 
   uint32_t count = m_newHeaders.Count();
   nsString folderName;
   folder->GetPrettyName(folderName);
   MOZ_LOG(FILTERLOGMODULE, LogLevel::Info,
           ("(News) Running filters on %" PRIu32 " new messages in folder '%s'",
            count, NS_ConvertUTF16toUTF8(folderName).get()));
 
-  // Notify MsgFolderListeners of message adds
-  nsCOMPtr<nsIMsgFolderNotificationService> notifier(
-      do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID));
-
   for (uint32_t i = 0; i < count; i++) {
     m_newMsgHdr = m_newHeaders[i];
     if (!filterCount && !serverFilterCount) {
       m_newsDB->AddNewHdrToDB(m_newMsgHdr, true);
 
-      if (notifier) notifier->NotifyMsgAdded(m_newMsgHdr);
       // mark the header as not yet reported classified
       nsMsgKey msgKey;
       m_newMsgHdr->GetMessageKey(&msgKey);
       folder->OrProcessingFlags(msgKey,
                                 nsMsgProcessingFlags::NotReportedClassified);
 
       continue;
     }
@@ -1093,17 +1088,17 @@ nsresult nsNNTPNewsgroupList::CallFilter
           nsMsgFilterType::NewsRule, m_newMsgHdr, folder, m_newsDB, fullHeaders,
           this, m_msgWindow);
     }
 
     NS_ENSURE_SUCCESS(rv, rv);
 
     if (m_addHdrToDB) {
       m_newsDB->AddNewHdrToDB(m_newMsgHdr, true);
-      if (notifier) notifier->NotifyMsgAdded(m_newMsgHdr);
+
       // mark the header as not yet reported classified
       nsMsgKey msgKey;
       m_newMsgHdr->GetMessageKey(&msgKey);
       folder->OrProcessingFlags(msgKey,
                                 nsMsgProcessingFlags::NotReportedClassified);
     }
   }
   m_newHeaders.Clear();
