# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1637486783 -3600
# Parent  058f0e3a497b5fe49e7b92e1b5be13ff1705a9c5
Bug 1739609 - Fix communication of charset back to UI.

diff --git a/mailnews/mime/src/mimetext.cpp b/mailnews/mime/src/mimetext.cpp
--- a/mailnews/mime/src/mimetext.cpp
+++ b/mailnews/mime/src/mimetext.cpp
@@ -73,17 +73,19 @@ static int MimeInlineText_initializeChar
   text->charsetOverridable = false;
 
   // Figure out an appropriate charset for this object.
   if (!text->charset && obj->headers) {
     if (obj->options && obj->options->override_charset) {
       if (obj->options->default_charset) {
         text->charset = strdup(obj->options->default_charset);
       } else {
+        text->charsetOverridable = true;
         text->inputAutodetect = true;
+        text->needUpdateMsgWinCharset = true;
         text->charset = strdup("");
       }
     } else {
       char* ct =
           MimeHeaders_get(obj->headers, HEADER_CONTENT_TYPE, false, false);
       if (ct) {
         text->charset = MimeHeaders_get_parameter(ct, "charset", NULL, NULL);
         PR_Free(ct);
@@ -104,16 +106,17 @@ static int MimeInlineText_initializeChar
       // files default to UTF-8 (RFC 2445, section 4.1.4).
       if (!text->charset && obj->content_type &&
           !PL_strcasecmp(obj->content_type, TEXT_CALENDAR))
         text->charset = strdup("UTF-8");
 
       if (!text->charset) {
         text->charsetOverridable = true;
         text->inputAutodetect = true;
+        text->needUpdateMsgWinCharset = true;
 
         if (obj->options && obj->options->default_charset)
           text->charset = strdup(obj->options->default_charset);
         else
           text->charset = strdup("UTF-8");
       }
     }
   }
