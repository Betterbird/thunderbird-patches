# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1628366299 -7200
# Parent  b94d28b51a4ffb9e5b6f30be2dce7c95fce703a1
Bug 1693332 - Re-establish Enigmail's "Decrypt to Folder".

Also integrate changes from https://gitlab.com/enigmail/enigmail/-/commit/f990a63246676820c54d3e4effb8fb8961c54416

diff --git a/mail/base/content/mainPopupSet.inc.xhtml b/mail/base/content/mainPopupSet.inc.xhtml
--- a/mail/base/content/mainPopupSet.inc.xhtml
+++ b/mail/base/content/mainPopupSet.inc.xhtml
@@ -378,16 +378,36 @@
               label="&contextSaveAs.label;"
               accesskey="&contextSaveAs.accesskey;"
               oncommand="MsgSaveAsFile();"/>
     <menuitem id="mailContext-print"
               label="&contextPrint.label;"
               accesskey="&contextPrint.accesskey;"
               observes="cmd_print"
               command="cmd_print"/>
+#ifdef MOZ_OPENPGP
+    <menuseparator id="mailContext-afterPrint" class="openpgp-item"/>
+    <menu id="mailContext-decryptToFolder"
+          class="openpgp-item"
+          label="&contextDecryptToFolder.label;"
+          accesskey="&contextDecryptToFolder.accesskey;"
+          oncommand="Enigmail.msg.decryptToFolder(event.target._folder);">
+      <menupopup id="mailContext-decryptToTargetFolder"
+                 is="folder-menupopup"
+                 mode="filing"
+                 showFileHereLabel="true"
+                 showRecent="true"
+                 recentLabel="&contextMoveCopyMsgRecentMenu.label;"
+                 recentAccessKey="&contextMoveCopyMsgRecentMenu.accesskey;"
+                 showFavorites="true"
+                 favoritesLabel="&contextMoveCopyMsgFavoritesMenu.label;"
+                 favoritesAccessKey="&contextMoveCopyMsgFavoritesMenu.accesskey;"
+                 hasbeenopened="false" />
+    </menu>
+#endif
 #endif
     <menuitem id="downloadSelected"
               label="&downloadSelectedCmd.label;"
               accesskey="&downloadSelectedCmd.accesskey;"
               command="cmd_downloadSelected"/>
     <menuseparator id="mailContext-sep-edit"/>
     <menuitem id="mailContext-copylink"
               label="&copyLinkCmd.label;"
diff --git a/mail/locales/en-US/chrome/messenger/messenger.dtd b/mail/locales/en-US/chrome/messenger/messenger.dtd
--- a/mail/locales/en-US/chrome/messenger/messenger.dtd
+++ b/mail/locales/en-US/chrome/messenger/messenger.dtd
@@ -787,16 +787,18 @@
   -->
 <!ENTITY contextWatchThreadMenu.accesskey "">
 <!ENTITY contextSaveAs.label "Save As…">
 <!ENTITY contextSaveAs.accesskey "S">
 <!ENTITY contextPrint.label "Print…">
 <!ENTITY contextPrint.accesskey "P">
 <!ENTITY contextPrintPreview.label "Print Preview">
 <!ENTITY contextPrintPreview.accesskey "v">
+<!ENTITY contextDecryptToFolder.label "Decrypt to Folder">
+<!ENTITY contextDecryptToFolder.accesskey "Y">
 
 <!-- LOCALIZATION NOTE (columnPicker.applyTo.label):
      This option in the thread pane column picker pops up a sub-menu containing
      the "columnPicker.applyToFolder.label" and
      "columnPicker.applyToFolderAndChildren.label" options. This item indicates
      a desire to apply the currently displayed set of columns to some other
      folder(s). The sub-menu items indicate whether we want to apply it to just
      a folder or also its children.
