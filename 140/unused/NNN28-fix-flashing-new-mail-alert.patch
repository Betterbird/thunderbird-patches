# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1758227619 -7200
# Parent  2f956cbaaad06870c20bd60db35c1840a2156708
NNN28 - Fix flashing new mail alert window.

diff --git a/mailnews/base/src/MailNotificationManager.sys.mjs b/mailnews/base/src/MailNotificationManager.sys.mjs
--- a/mailnews/base/src/MailNotificationManager.sys.mjs
+++ b/mailnews/base/src/MailNotificationManager.sys.mjs
@@ -485,15 +485,36 @@ export class MailNotificationManager {
     args.appendElement({
       wrappedJSObject: newMsgKeys,
     });
     args.appendElement(this);
-    Services.ww.openWindow(
+    const win = Services.ww.openWindow(
       null,
       "chrome://messenger/content/newmailalert.xhtml",
       "_blank",
       "chrome,dialog,titlebar=no,alert=yes",
       args
     );
+    // Move window to its final position, so in case it
+    // flashes, it will at least "flash in place".
+    let screenToUse = win.screen;
+    if (
+      Services.prefs.getBoolPref("mail.notification.show_on_app_screen", false)
+    ) {
+      const appWindow = Services.wm.getMostRecentWindow("mail:3pane");
+      if (
+        appWindow &&
+        (appWindow.screenLeft < 0 || appWindow.screenLeft > win.screen.width)
+      ) {
+        // Application screen to the left or the right of the primary screen.
+        screenToUse = appWindow.screen;
+      }
+    }
+    const x =
+      screenToUse.availLeft + screenToUse.availWidth - win.outerWidth - 10;
+    const y =
+      screenToUse.availTop + screenToUse.availHeight - win.outerHeight - 10;
+    win.moveTo(x, y);
+
     this._customizedAlertShown = true;
     this._saveNotificationTime(folder, newMsgKeys);
   }
 
