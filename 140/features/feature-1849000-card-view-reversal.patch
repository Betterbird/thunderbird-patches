# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1755718821 -7200
# Parent  481d614d79b31de89385fd7942267212e4836fb0
Backed out changeset b082e72edb30
Bug 1849000 - Revert bug 1849000 and bug 1865057, card view (mail.threadpane.listview), vertical view (mail.pane_config.dynamic).

diff --git a/mail/app/profile/all-thunderbird.js b/mail/app/profile/all-thunderbird.js
--- a/mail/app/profile/all-thunderbird.js
+++ b/mail/app/profile/all-thunderbird.js
@@ -374,9 +374,9 @@ pref("mail.showCondensedAddresses", true
 
 pref("mailnews.attachments.display.start_expanded", false);
 pref("mailnews.attachments.display.top", false);
 // hidden pref for changing how we present attachments in the message pane
-pref("mail.pane_config.dynamic", 2);
+pref("mail.pane_config.dynamic", 0);
 pref("editor.singleLine.pasteNewlines", 4);  // substitute commas for new lines in single line text boxes
 pref("editor.CR_creates_new_p", true);
 pref("mail.compose.default_to_paragraph", true);
 
@@ -1537,8 +1537,8 @@ pref("calendar.dialogs.new.enabled", fal
 // Layout and UI settings.
 // List view style for the thread pane:
 // 0 - Cards view.
 // 1 - Table view.
-pref("mail.threadpane.listview", 0);
+pref("mail.threadpane.listview", 1);
 
 // Row count for the cards view, currently bound to a range between 2 and 3.
 pref("mail.threadpane.cardsview.rowcount", 3);
diff --git a/mail/modules/MailMigrator.sys.mjs b/mail/modules/MailMigrator.sys.mjs
--- a/mail/modules/MailMigrator.sys.mjs
+++ b/mail/modules/MailMigrator.sys.mjs
@@ -33,8 +33,25 @@ export var MailMigrator = {
     const UI_VERSION = 51;
     const UI_VERSION_PREF = "mail.ui-rdf.version";
     let currentUIVersion = Services.prefs.getIntPref(UI_VERSION_PREF, 0);
 
+    // In BB 140.2.0 we accidentally shipped mail.threadpane.listview with
+    // default value 0, "cards view". Let's revert this.
+    if (currentUIVersion == 51) {
+      if (Services.prefs.getIntPref("betterbird.migration", 0) == 0) {
+        if (!Services.prefs.prefHasUserValue("mail.threadpane.listview")) {
+          // The pref wasn't changed by the user, so the user had "cards view"
+          // before. Now that the pref is default is 1, set it back to 0,
+          // so users don't lose their cards view.
+          console.info("Maintaining previous pref value 0 for mail.threadpane.listview: Cards view");
+          Services.prefs.setIntPref("mail.threadpane.listview", 0);
+        } else {
+          console.info("Maintaining previous pref value 1 for mail.threadpane.listview: Table view");
+        }
+        Services.prefs.setIntPref("betterbird.migration", 1);
+      }
+    }
+
     if (currentUIVersion >= UI_VERSION) {
       return;
     }
 
