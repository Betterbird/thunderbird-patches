# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1757619392 -7200
# Parent  3b5364ce921c2701a42286720ce946f08f42a815
Bug 1566458 - Quit application if master password isn't entered.

Inspired by https://phabricator.services.mozilla.com/D166645

diff --git a/toolkit/xre/nsXREDirProvider.cpp b/toolkit/xre/nsXREDirProvider.cpp
--- a/toolkit/xre/nsXREDirProvider.cpp
+++ b/toolkit/xre/nsXREDirProvider.cpp
@@ -621,8 +621,12 @@ nsXREDirProvider::DoStartup() {
       if (db) {
         nsCOMPtr<nsIPK11Token> token;
         if (NS_SUCCEEDED(db->GetInternalKeyToken(getter_AddRefs(token)))) {
           mozilla::Unused << token->Login(false);
+          bool isLoggedIn = false;
+          if (NS_FAILED(token->IsLoggedIn(&isLoggedIn)) || !isLoggedIn) {
+            exit(1);
+          }
         }
       } else {
         NS_WARNING("Failed to get nsIPK11TokenDB service.");
       }
