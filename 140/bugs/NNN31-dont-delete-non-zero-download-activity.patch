# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1768329841 -3600
# Parent  46773c43323e1f07b1a0bf421234c5173c585d94
NNN31 - Don't throw away previous activity when it reported non-zero downloads.

Use grey icon if no messages are downloaded.

diff --git a/mail/components/activity/modules/pop3Download.sys.mjs b/mail/components/activity/modules/pop3Download.sys.mjs
--- a/mail/components/activity/modules/pop3Download.sys.mjs
+++ b/mail/components/activity/modules/pop3Download.sys.mjs
@@ -97,9 +97,9 @@ export var pop3DownloadModule = {
     // It can happen that download never started (e.g. couldn't connect to server),
     // with onDownloadStarted, but we still get a onDownloadCompleted event
     // when the connection is given up.
     const recentActivity = this._mostRecentActivityForFolder.get(aFolder.URI);
-    if (recentActivity) {
+    if (recentActivity && !recentActivity.numMsgsDownloaded) {
       this.activityMgr.removeActivity(recentActivity.eventID);
     }
 
     let displayText;
@@ -123,9 +123,9 @@ export var pop3DownloadModule = {
       Date.now(), // start time
       Date.now()
     ); // completion time
 
-    event.iconClass = "syncMail";
+    event.iconClass = "syncMail" + (aNumMsgsDownloaded ? "" : "None");
 
     const downloadItem = { numMsgsDownloaded: aNumMsgsDownloaded };
     this._mostRecentActivityForFolder.set(aFolder.URI, downloadItem);
     downloadItem.eventID = this.activityMgr.addActivity(event);
diff --git a/mail/themes/shared/jar.inc.mn b/mail/themes/shared/jar.inc.mn
--- a/mail/themes/shared/jar.inc.mn
+++ b/mail/themes/shared/jar.inc.mn
@@ -768,8 +768,9 @@
   skin/classic/messenger/icons/new/activity/moveMailIcon.svg   (../shared/mail/icons/new/activity/moveMailIcon.svg)
   skin/classic/messenger/icons/new/activity/removeItemIcon.svg (../shared/mail/icons/new/activity/removeItemIcon.svg)
   skin/classic/messenger/icons/new/activity/sendMailIcon.svg   (../shared/mail/icons/new/activity/sendMailIcon.svg)
   skin/classic/messenger/icons/new/activity/syncMailIcon.svg   (../shared/mail/icons/new/activity/syncMailIcon.svg)
+  skin/classic/messenger/icons/new/activity/syncMailNoneIcon.svg (../shared/mail/icons/new/activity/syncMailNoneIcon.svg)
   skin/classic/messenger/icons/new/activity/undoIcon.svg       (../shared/mail/icons/new/activity/undoIcon.svg)
   skin/classic/messenger/icons/new/activity/warning.svg        (../shared/mail/icons/new/activity/warning.svg)
   skin/classic/messenger/icons/new/activity/question.svg       (../shared/mail/icons/new/activity/question.svg)
   skin/classic/messenger/icons/new/activity/info.svg           (../shared/mail/icons/new/activity/info.svg)
diff --git a/mail/themes/shared/mail/icons/new/activity/syncMailNoneIcon.svg b/mail/themes/shared/mail/icons/new/activity/syncMailNoneIcon.svg
new file mode 100644
--- /dev/null
+++ b/mail/themes/shared/mail/icons/new/activity/syncMailNoneIcon.svg
@@ -0,0 +1,4 @@
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<svg width="48" height="48" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="a"><stop style="stop-color:#91a398;stop-opacity:1" offset="0"/><stop style="stop-color:#b0c5b8;stop-opacity:1" offset="1"/></linearGradient><linearGradient xlink:href="#a" id="b" x1="24.025" y1="654.52" x2="24.025" y2="612.546" gradientUnits="userSpaceOnUse"/></defs><path style="opacity:1;fill:url(#b);stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stop-color:#000" d="M46.026 634.546a22 22 0 0 1-22 22 22 22 0 0 1-22-22 22 22 0 0 1 22-22 22 22 0 0 1 22 22z" transform="translate(0 -610.52)"/><path style="fill:#166534;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stop-color:#000" d="M24 616.52c-9.941 0-18 8.059-18 18 0 9.94 8.059 18 18 18s18-8.06 18-18c0-9.941-8.059-18-18-18zm0 2c8.837 0 16 7.163 16 16 0 8.836-7.163 16-16 16s-16-7.164-16-16c0-8.837 7.163-16 16-16zm0 5c-2.989 0-5.71 1.198-7.693 3.138a1 1 0 0 0-.016 1.414 1 1 0 0 0 1.414.016A8.958 8.958 0 0 1 24 625.52c4.84 0 8.77 3.791 8.99 8.576l-1.283-1.283a1 1 0 0 0-.707-.293 1 1 0 0 0-.707.293 1 1 0 0 0 0 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414 1 1 0 0 0-1.414 0l-1.303 1.302c-.214-5.876-5.062-10.595-10.99-10.595zm-9.85 8.996a1 1 0 0 0-.103.01 1 1 0 0 0-.754.287l-3 3a1 1 0 0 0 0 1.414 1 1 0 0 0 1.414 0l1.377-1.377c.66 5.438 5.303 9.67 10.916 9.67 3.035 0 5.795-1.235 7.785-3.229a1 1 0 0 0-.002-1.414 1 1 0 0 0-1.414 0A8.958 8.958 0 0 1 24 643.52a8.983 8.983 0 0 1-8.865-7.452l1.158 1.159a1 1 0 0 0 1.414 0 1 1 0 0 0 0-1.414l-2.78-2.78a1 1 0 0 0-.777-.517zm31.829.662c-.356 11.874-10.074 21.322-21.954 21.342-11.738-.026-21.388-9.263-21.927-20.989-.032.338-.056.676-.073 1.014 0 12.15 9.85 22 22 22s22-9.85 22-22a21.973 21.973 0 0 0-.046-1.367z" transform="translate(0 -610.52)"/><path style="fill:#f1f3fa;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stop-color:#000" d="M24 615.52c-9.941 0-18 8.059-18 18 0 9.94 8.059 18 18 18s18-8.06 18-18c0-9.941-8.059-18-18-18zm0 2c8.837 0 16 7.163 16 16 0 8.836-7.163 16-16 16s-16-7.164-16-16c0-8.837 7.163-16 16-16zm0 5c-2.989 0-5.71 1.198-7.693 3.138a1 1 0 0 0-.016 1.414 1 1 0 0 0 1.414.016A8.958 8.958 0 0 1 24 624.52c4.84 0 8.77 3.791 8.99 8.576l-1.283-1.283a1 1 0 0 0-.707-.293 1 1 0 0 0-.707.293 1 1 0 0 0 0 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414 1 1 0 0 0-1.414 0l-1.303 1.302c-.214-5.876-5.062-10.595-10.99-10.595zm-9.85 8.996a1 1 0 0 0-.103.01 1 1 0 0 0-.754.287l-3 3a1 1 0 0 0 0 1.414 1 1 0 0 0 1.414 0l1.377-1.377c.66 5.438 5.303 9.67 10.916 9.67 3.035 0 5.795-1.235 7.785-3.229a1 1 0 0 0-.002-1.414 1 1 0 0 0-1.414 0A8.958 8.958 0 0 1 24 642.52a8.983 8.983 0 0 1-8.865-7.452l1.158 1.159a1 1 0 0 0 1.414 0 1 1 0 0 0 0-1.414l-2.78-2.78a1 1 0 0 0-.777-.517z" transform="translate(0 -610.52)"/></svg>
