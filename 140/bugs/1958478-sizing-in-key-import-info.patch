# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1757446666 -7200
# Parent  42d64ff928c220843dae5de0466f50dd27d1fc98
Bug 1958478 - Fix sizing issues for enigmailKeyImportInfo.xhtml.

diff --git a/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.js b/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.js
--- a/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.js
+++ b/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.js
@@ -23,16 +23,8 @@ async function onLoad() {
   const dlg = document.getElementById("enigmailKeyImportInfo");
 
   const keys = [];
 
-  if (window.screen.width > 500) {
-    dlg.setAttribute("maxwidth", window.screen.width - 150);
-  }
-
-  if (window.screen.height > 300) {
-    dlg.setAttribute("maxheight", window.screen.height - 100);
-  }
-
   var keyList = window.arguments[0].keyList;
 
   const onClickFunc = function (event) {
     const keyId = event.target.getAttribute("keyid");
@@ -74,10 +66,9 @@ async function onLoad() {
     setTimeout(window.close, 0);
     return;
   }
 
-  setTimeout(resizeDlg);
-  setTimeout(() => window.sizeToContent());
+  setTimeout(() => adjustDialogSize(keys.length));
 }
 
 function buildKeyGroupBox(keyObj) {
   const groupBox = document.createXULElement("vbox");
@@ -137,33 +128,26 @@ function buildKeyGroupBox(keyObj) {
 
   return groupBox;
 }
 
-function resizeDlg() {
-  var txt = document.getElementById("keyInfo");
-  var box = document.getElementById("outerbox");
-
-  var deltaWidth = window.outerWidth - box.clientWidth;
-  var newWidth = txt.scrollWidth + deltaWidth + 20;
-
-  if (newWidth > window.screen.width - 50) {
-    newWidth = window.screen.width - 50;
+function adjustDialogSize(numKeys) {
+  // Don't overflow the screen in height.
+  const screenHeight = window.screen.height;
+  let windowHeight = window.outerHeight;
+  if (windowHeight > screenHeight - 100) {
+    windowHeight = screenHeight - 100;
   }
 
-  txt.style["white-space"] = "pre-wrap";
-  window.resizeTo(newWidth, window.outerHeight);
-
-  var textHeight = txt.scrollHeight;
-  var boxHeight = box.clientHeight;
-  var deltaHeight = window.outerHeight - boxHeight;
+  // Each individual info box is 250px wide, but we need to
+  // cater for margins and potential scrollbar if there are
+  // more than 4 keys.
+  const windowWidth = numKeys >= 4 ? 830 : numKeys * 255 + 45;
 
-  var newHeight = textHeight + deltaHeight + 25;
-
-  if (newHeight > window.screen.height - 100) {
-    newHeight = window.screen.height - 100;
-  }
-
-  window.resizeTo(newWidth, newHeight);
+  // For some reason, resizing alone doesn't work without setting
+  // the HTML's min-size.
+  window.document.documentElement.style.minWidth = windowWidth + "px";
+  window.resizeTo(windowWidth, windowHeight);
+  return;
 }
 
 function dlgClose(buttonNumber) {
   window.arguments[1].value = buttonNumber;
diff --git a/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.xhtml b/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.xhtml
--- a/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.xhtml
+++ b/mail/extensions/openpgp/content/ui/enigmailKeyImportInfo.xhtml
@@ -7,10 +7,9 @@
 <html
   xmlns="http://www.w3.org/1999/xhtml"
   xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
   xmlns:html="http://www.w3.org/1999/xhtml"
-  style="min-width: 400px; max-width: 750px; min-height: 250px"
-  scrolling="false"
+  style="min-height: 250px"
 >
   <head>
     <title data-l10n-id="import-info-dialog-title"></title>
     <meta
@@ -34,9 +33,9 @@
   </head>
   <html:body
     xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
   >
-    <dialog id="enigmailKeyImportInfo" buttons="accept" style="width: 100vw">
+    <dialog id="enigmailKeyImportInfo" buttons="accept" style="width: 100vw; overflow: scroll">
       <vbox align="center" flex="1" style="overflow: auto" id="outerbox">
         <hbox align="center" flex="1">
           <description
             flex="1"
diff --git a/mail/themes/shared/openpgp/enigmail.css b/mail/themes/shared/openpgp/enigmail.css
--- a/mail/themes/shared/openpgp/enigmail.css
+++ b/mail/themes/shared/openpgp/enigmail.css
@@ -10,8 +10,10 @@
   border-width: thin;
   padding: 3px;
   margin: 3px;
   border-color: lightgrey;
+  width: 250px;
+  overflow: scroll;
 }
 
 .enigmailGroupboxMargin {
   margin: 10px 3px;
