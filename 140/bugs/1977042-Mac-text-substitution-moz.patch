# HG changeset patch
# User Makoto Kato <m_kato@ga2.so-net.ne.jp>
# Date 1757702121 -7200
# Parent  d1ebbb27ad61d1da5997f45405cfe2fdac741472
Bug 1977042 - Text substitution isn't processed at Thunderbird compose window.

From https://phabricator.services.mozilla.com/D263834 as of 12 Sep. 2025

diff --git a/widget/cocoa/TextInputHandler.mm b/widget/cocoa/TextInputHandler.mm
--- a/widget/cocoa/TextInputHandler.mm
+++ b/widget/cocoa/TextInputHandler.mm
@@ -2621,10 +2621,10 @@ void TextInputHandler::InsertText(NSStri
   bool keyPressHandled = (status == nsEventStatus_eConsumeNoDefault);
 
   // WebKit and text editor dismisses autocorrect panel by space, then process
   // autocorrect.
-  if (keypressEvent.mKeyCode == NS_VK_SPACE && keyPressDispatched) {
-    mProcessTextSubstitution = true;
+  if (keyPressDispatched) {
+    mProcessTextSubstitution = (keypressEvent.mKeyCode == NS_VK_SPACE);
     DismissTextSubstitutionPanel();
   }
 
   // Note: mWidget might have become null here. Don't count on it from here on.
