# HG changeset patch
# User Geoff Lankow <geoff@darktrojan.net>
# Date 1762943561 -7200
# Node ID 6307b7196c16602532081971fc06e8bcf168a9d9
# Parent  ca26b40a67566615170f2e917c7ba474124c9d0d
Bug 1999556 - Prevent renaming of Spam folders in the UI. r=mkmelin

Differential Revision: https://phabricator.services.mozilla.com/D272179

diff --git a/mail/base/content/about3Pane.js b/mail/base/content/about3Pane.js
--- a/mail/base/content/about3Pane.js
+++ b/mail/base/content/about3Pane.js
@@ -436,20 +436,17 @@ var folderPaneContextMenu = {
       deletable = true;
     }
 
     this._commandStates = {
       cmd_newFolder: online && ((!isNNTP && canCreateSubfolders) || isInbox),
       cmd_deleteFolder:
         online && (isJunk ? canRenameDeleteJunkMail : deletable),
       cmd_renameFolder:
-        online &&
-        ((!isServer && canRename && !isSpecialUse) ||
-          isVirtual ||
-          (isJunk && canRenameDeleteJunkMail)),
+        online && ((!isServer && canRename && !isSpecialUse) || isVirtual),
       cmd_compactFolder:
         !isVirtual && !isNNTP && (isServer || canCompact) && isCompactEnabled,
       cmd_emptyTrash: online && !isNNTP,
       cmd_properties: !multiSelection && !isServer && !isSmartTagsFolder,
       cmd_toggleFavoriteFolder:
         !multiSelection && !isServer && !isSmartTagsFolder,
     };
     return this._commandStates[command];
diff --git a/mailnews/base/src/FolderUtils.sys.mjs b/mailnews/base/src/FolderUtils.sys.mjs
--- a/mailnews/base/src/FolderUtils.sys.mjs
+++ b/mailnews/base/src/FolderUtils.sys.mjs
@@ -323,17 +323,19 @@ function isSmartTagsFolder(folder) {
   return (
     folder.isSpecialFolder(Ci.nsMsgFolderFlags.Virtual) &&
     folder.server.hostName == "smart mailboxes" &&
     folder.parent?.name == "tags"
   );
 }
 
 /**
- * Checks if the configured junk mail can be renamed or deleted.
+ * Checks if the configured junk mail can be renamed or deleted. In practice
+ * we no longer permit renaming folders with the Junk flag as the name is
+ * overridden by a localised name.
  *
  * @param {string} aFolderUri
  */
 function canRenameDeleteJunkMail(aFolderUri) {
   // Go through junk mail settings for all servers and see if the folder is set/used by anyone.
   for (const server of MailServices.accounts.allServers) {
     const settings = server.spamSettings;
     // If junk mail control or move junk mail to folder option is disabled then

