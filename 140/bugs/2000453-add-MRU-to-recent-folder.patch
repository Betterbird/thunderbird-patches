# HG changeset patch
# User welpy-cw <h.w.forms@arcor.de>
# Date 1766331845 -3600
# Parent  073e6d7ed2131209b0555e030ee5b4f7157cccf7
Bug 2000453 - Split the "Recent destinations" submenu into an MRU and an alphabetically sorted section.

diff --git a/mailnews/base/content/folder-menupopup.js b/mailnews/base/content/folder-menupopup.js
--- a/mailnews/base/content/folder-menupopup.js
+++ b/mailnews/base/content/folder-menupopup.js
@@ -609,17 +609,43 @@
                 : "")
             : folderItem.folderName;
         }
 
-        // If appropriate, sort the entries alphabetically.
-        if (specialType != "recent") {
-          specialFoldersMap.sort((a, b) =>
-            lazy.FolderUtils.folderNameCompare(a.label, b.label)
-          );
+        // Sort the special folders alphabetically, except for "Recent
+        // destinations" where a short list of the most recently used folders
+        // is placed first.
+        let mruCount = 0;
+        const totalCount = specialFoldersMap.length;
+        if (specialType == "recent") {
+          // Show about 20% of the total items, but at most 5, in the order of
+          // most recent use. Also show small lists consisting of up to five
+          // items in MRU order.
+          mruCount =
+            totalCount < 6
+              ? totalCount
+              : Math.min(Math.ceil(totalCount / 5), 5);
+        }
+        let mruFoldersMap = [];
+        if (mruCount) {
+          // Remove the MRU items from the main list.
+          mruFoldersMap = specialFoldersMap.splice(0, mruCount);
+        }
+        // Sort the main list alphabetically.
+        specialFoldersMap.sort((a, b) =>
+          lazy.FolderUtils.folderNameCompare(a.label, b.label)
+        );
+        if (mruCount) {
+          // Re-insert MRU items at the front of the list.
+          specialFoldersMap.splice(0, 0, ...mruFoldersMap);
         }
 
         // Create entries for each of the special folders.
-        for (const folderItem of specialFoldersMap) {
+        specialFoldersMap.forEach((folderItem, index) => {
+          if (mruCount && index == mruCount) {
+            // Add a separator between the most recently used entries
+            // and the alphabetically sorted entries.
+            submenu.childWrapper.appendChild(this._buildSeparator());
+          }
           const attributes = {
             label: folderItem.label,
             tooltiptext: `${folderItem.folderPath} - ${folderItem.serverName}`,
             crop: "start",
@@ -627,9 +653,9 @@
           };
           submenu.childWrapper.appendChild(
             this._buildMenuItem(attributes, folderItem.folder)
           );
-        }
+        });
 
         if (specialFoldersMap.length == 0) {
           menu.setAttribute("disabled", "true");
         }
