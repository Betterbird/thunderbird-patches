# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1766343038 -3600
# Parent  01dd7a83cacbf96a8e549664848623cbc5d6464b
Bug 1852171 - Reinstate pref mail.folderpane.sumSubfolders.

diff --git a/mail/base/content/widgets/folder-tree-row.mjs b/mail/base/content/widgets/folder-tree-row.mjs
--- a/mail/base/content/widgets/folder-tree-row.mjs
+++ b/mail/base/content/widgets/folder-tree-row.mjs
@@ -277,9 +277,12 @@ class FolderTreeRow extends HTMLLIElemen
     this._nameStyle = "server";
     this._serverName = server.prettyName;
     this._setName();
     const isCollapsed = this.classList.contains("collapsed");
-    if (isCollapsed) {
+    const includeSubfolders = Services.prefs.getBoolPref(
+      "mail.folderpane.sumSubfolders"
+    );
+    if (includeSubfolders && isCollapsed) {
       this.unreadCount = server.rootFolder.getNumUnread(isCollapsed);
       this.totalCount = server.rootFolder.getTotalMessages(isCollapsed);
     }
     this.setFolderPropertiesFromFolder(server.rootFolder);
@@ -314,10 +317,13 @@ class FolderTreeRow extends HTMLLIElemen
       isCollapsed
         ? folder.hasFolderOrSubfolderNewMessages
         : folder.hasNewMessages
     );
-    this.unreadCount = folder.getNumUnread(isCollapsed);
-    this.totalCount = folder.getTotalMessages(isCollapsed);
+    const includeSubfolders = Services.prefs.getBoolPref(
+      "mail.folderpane.sumSubfolders"
+    );
+    this.unreadCount = folder.getNumUnread(includeSubfolders && isCollapsed);
+    this.totalCount = folder.getTotalMessages(includeSubfolders && isCollapsed);
     if (lazy.XULStoreUtils.isItemVisible("messenger", "folderPaneFolderSize")) {
       this.folderSize = this.formatFolderSize(folder.sizeOnDisk);
     }
     this.folderSortOrder = folder.sortOrder;
@@ -367,17 +373,23 @@ class FolderTreeRow extends HTMLLIElemen
     );
   }
 
   updateUnreadMessageCount() {
+    const includeSubfolders = Services.prefs.getBoolPref(
+      "mail.folderpane.sumSubfolders"
+    );
     this.unreadCount = lazy.MailServices.folderLookup
       .getFolderForURL(this.uri)
-      .getNumUnread(this.classList.contains("collapsed"));
+      .getNumUnread(includeSubfolders && this.classList.contains("collapsed"));
   }
 
   updateTotalMessageCount() {
     const folder = lazy.MailServices.folderLookup.getFolderForURL(this.uri);
+    const includeSubfolders = Services.prefs.getBoolPref(
+      "mail.folderpane.sumSubfolders"
+    );
     this.totalCount = folder.getTotalMessages(
-      this.classList.contains("collapsed")
+      includeSubfolders && this.classList.contains("collapsed")
     );
     if (lazy.XULStoreUtils.isItemVisible("messenger", "folderPaneFolderSize")) {
       this.updateSizeCount(false, folder);
     }
@@ -409,9 +421,12 @@ class FolderTreeRow extends HTMLLIElemen
       this.folderSize = "";
       return;
     }
 
-    if (this.classList.contains("collapsed")) {
+    const includeSubfolders = Services.prefs.getBoolPref(
+      "mail.folderpane.sumSubfolders"
+    );
+    if (includeSubfolders && this.classList.contains("collapsed")) {
       sizeCount += getChildrenSizeCount(this);
     }
     this.folderSize = this.formatFolderSize(sizeCount);
   }
