# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1766785511 -3600
# Parent  cf622a3bb147a36cfda36fc572e6de4dd5236c61
Bug 900117 - Allow escaping of comma in command line -compose "attachment='file\,part.txt'"

diff --git a/mail/components/compose/content/MsgComposeCommands.js b/mail/components/compose/content/MsgComposeCommands.js
--- a/mail/components/compose/content/MsgComposeCommands.js
+++ b/mail/components/compose/content/MsgComposeCommands.js
@@ -4835,9 +4835,12 @@ async function ComposeStartup() {
       if (args.subject) {
         composeFields.subject = args.subject;
       }
       if (args.attachment && window.arguments[1] instanceof Ci.nsICommandLine) {
-        const attachmentList = args.attachment.split(",");
+        // Use negative "lookbehind", don't split if preceded by backslash.
+        const attachmentList = args.attachment
+          .split(/(?<!\\),/)
+          .map(s => s.replace(/\\,/g, ","));
         for (const attachmentName of attachmentList) {
           // resolveURI does all the magic around working out what the
           // attachment is, including web pages, and generating the correct uri.
           const uri = window.arguments[1].resolveURI(attachmentName);
