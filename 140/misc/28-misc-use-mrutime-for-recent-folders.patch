# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1758995692 -7200
# Parent  22b93dfc6ec11781139a7c61746592ae97489363
Misc: Use MRUTime for recent folders instead of MRMTime.

diff --git a/mailnews/base/content/folder-menupopup.js b/mailnews/base/content/folder-menupopup.js
--- a/mailnews/base/content/folder-menupopup.js
+++ b/mailnews/base/content/folder-menupopup.js
@@ -271,8 +271,28 @@
                 this._getChildForItem(folder, recentSubMenu)
               ) {
                 return;
               }
+            } else if (eventName == "MRUTimeChanged") {
+              if (
+                this._menu.getAttribute("showUsed") != "true" ||
+                !this._menu._initializedSpecials.has("used") ||
+                !this._menu.childWrapper.firstElementChild
+              ) {
+                return;
+              }
+
+              const recentMenuItem = this._menu.childWrapper.firstElementChild;
+              const recentSubMenu =
+                this._menu._getSubMenuForMenuItem(recentMenuItem);
+
+              // If this folder is already in the recent menu, return.
+              if (
+                !recentSubMenu ||
+                this._getChildForItem(folder, recentSubMenu)
+              ) {
+                return;
+              }
             } else if (eventName == "RenameCompleted") {
               // Special casing folder renames here, since they require more work
               // since sort-order may have changed.
               if (!this._getChildForItem(folder)) {
@@ -478,8 +498,9 @@
        * Add menu items that only appear at top level, like "Recent".
        */
       _addTopLevelMenuItems() {
         const showRecent = this.getAttribute("showRecent") == "true";
+        const showUsed = this.getAttribute("showUsed") == "true";
         const showFavorites = this.getAttribute("showFavorites") == "true";
 
         if (showRecent) {
           this.childWrapper.appendChild(
@@ -489,8 +510,17 @@
               accessKey: this.getAttribute("recentAccessKey"),
             })
           );
         }
+        if (showUsed) {
+          this.childWrapper.appendChild(
+            this._buildSpecialMenu({
+              special: "used",
+              label: this.getAttribute("recentLabel"),
+              accessKey: this.getAttribute("recentAccessKey"),
+            })
+          );
+        }
         if (showFavorites) {
           this.childWrapper.appendChild(
             this._buildSpecialMenu({
               special: "favorites",
@@ -498,9 +528,9 @@
               accessKey: this.getAttribute("favoritesAccessKey"),
             })
           );
         }
-        if (showRecent || showFavorites) {
+        if (showRecent || showUsed || showFavorites) {
           this.childWrapper.appendChild(this._buildSeparator());
         }
       }
 
@@ -550,15 +580,23 @@
         }
 
         switch (specialType) {
           case "recent":
-            // Find the most recently modified ones.
+            // Find the "most recently moved to" ones.
             specialFolders = lazy.FolderUtils.getMostRecentFolders(
               specialFolders,
               Services.prefs.getIntPref("mail.folder_widget.max_recent"),
               "MRMTime"
             );
             break;
+          case "used":
+            // Find the most recently used ones.
+            specialFolders = lazy.FolderUtils.getMostRecentFolders(
+              specialFolders,
+              Services.prefs.getIntPref("mail.folder_widget.max_recent"),
+              "MRUTime"
+            );
+            break;
           case "favorites":
             specialFolders = specialFolders.filter(folder =>
               folder.getFlag(Ci.nsMsgFolderFlags.Favorite)
             );
diff --git a/mailnews/search/content/searchWidgets.js b/mailnews/search/content/searchWidgets.js
--- a/mailnews/search/content/searchWidgets.js
+++ b/mailnews/search/content/searchWidgets.js
@@ -143,9 +143,9 @@
                     displayformat="verbose">
             <menupopup is="folder-menupopup"
                        mode="filing"
                        class="menulist-menupopup"
-                       showRecent="true"
+                       showUsed="true"
                        recentLabel="&recentFolders.label;"
                        showFileHereLabel="true">
             </menupopup>
           </menulist>
