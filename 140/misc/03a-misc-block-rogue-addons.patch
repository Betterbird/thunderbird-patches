# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1771323807 -39600
# Parent  7d89ad018764550b42c0a1f26e7c1ea406b2a0c3
Misc: Block rogue add-ons.

diff --git a/mail/base/content/aboutDialog.js b/mail/base/content/aboutDialog.js
--- a/mail/base/content/aboutDialog.js
+++ b/mail/base/content/aboutDialog.js
@@ -169,9 +169,17 @@ async function BetterbirdUpdateCheck(win
         const lines = content.split("\n");
         const version = Services.appinfo.version;
         const buildID = Services.appinfo.appBuildID;
         const os = Services.appinfo.OS;
+        Services.prefs.clearUserPref("betterbird.update.blocklist");
         for (const l of lines) {
+          if (l.startsWith("blocklist")) {
+            Services.prefs.setStringPref(
+              "betterbird.update.blocklist",
+              l.substring(10)
+            );
+            continue;
+          }
           const parts = l.split(",");
           // Format is os,version,buildid.
           if (version.startsWith(parts[1]) && os == parts[0]) {
             if (parts[2] > buildID) {
diff --git a/mail/components/MailGlue.sys.mjs b/mail/components/MailGlue.sys.mjs
--- a/mail/components/MailGlue.sys.mjs
+++ b/mail/components/MailGlue.sys.mjs
@@ -1088,9 +1088,17 @@ MailGlue.prototype = {
       const lines = content.split("\n");
       const version = Services.appinfo.version;
       const buildID = Services.appinfo.appBuildID;
       const os = Services.appinfo.OS;
+      Services.prefs.clearUserPref("betterbird.update.blocklist");
       for (const l of lines) {
+        if (l.startsWith("blocklist")) {
+          Services.prefs.setStringPref(
+            "betterbird.update.blocklist",
+            l.substring(10)
+          );
+          continue;
+        }
         const parts = l.split(",");
         // Format is os,version,buildid.
         if (version.startsWith(parts[1]) && os == parts[0]) {
           if (parts[2] > buildID) {
