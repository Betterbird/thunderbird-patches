# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1683881930 -7200
# Parent  7fd3c3861bf7386d174b24d685478a90972c6581
Feature: Configurable icons.

diff --git a/calendar/base/content/dialogs/calendar-conflicts-dialog.xhtml b/calendar/base/content/dialogs/calendar-conflicts-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-conflicts-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-conflicts-dialog.xhtml
@@ -6,16 +6,17 @@
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/messenger.css"?>
 <?xml-stylesheet type="text/css" href="chrome://calendar/skin/calendar-views.css"?>
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/colors.css"?>
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/themeableDialog.css"?>
 
 <html id="calendar-conflicts-dialog" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:Conflicts"
       persist="screenX screenY"
       lightweightthemes="true"
       scrolling="false">
 <head>
   <link rel="localization" href="branding/brand.ftl" />
   <script defer="defer" src="chrome://calendar/content/widgets/mouseoverPreviews.js"></script>
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-creation.xhtml b/calendar/base/content/dialogs/calendar-creation.xhtml
--- a/calendar/base/content/dialogs/calendar-creation.xhtml
+++ b/calendar/base/content/dialogs/calendar-creation.xhtml
@@ -14,16 +14,17 @@
   <!ENTITY % dtd1 SYSTEM "chrome://calendar/locale/calendarCreation.dtd" > %dtd1;
   <!ENTITY % dtd2 SYSTEM "chrome://calendar/locale/calendar.dtd" > %dtd2;
   <!ENTITY % dtd3 SYSTEM "chrome://lightning/locale/lightning.dtd" > %dtd3;
   <!ENTITY % dtd4 SYSTEM "chrome://messenger/locale/messenger.dtd" > %dtd4;
 ]>
 <html xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       lightweightthemes="true"
       style="min-width: 500px; min-height: 380px;"
       scrolling="false">
 <head>
   <title>&wizard.title;</title>
   <link rel="localization" href="toolkit/global/wizard.ftl" />
   <script defer="defer" src="chrome://messenger/content/globalOverlay.js"></script>
   <script defer="defer" src="chrome://global/content/editMenuOverlay.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-error-prompt.xhtml b/calendar/base/content/dialogs/calendar-error-prompt.xhtml
--- a/calendar/base/content/dialogs/calendar-error-prompt.xhtml
+++ b/calendar/base/content/dialogs/calendar-error-prompt.xhtml
@@ -10,16 +10,17 @@
 <!DOCTYPE html
 [
     <!ENTITY % dtd1 SYSTEM "chrome://calendar/locale/global.dtd" > %dtd1;
     <!ENTITY % dtd2 SYSTEM "chrome://calendar/locale/calendar.dtd" > %dtd2;
 ]>
 <html id="calendar-error-prompt" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       lightweightthemes="true"
       scrolling="false">
 <head>
   <title>&calendar.error.title;</title>
   <script defer="defer" src="chrome://messenger/content/globalOverlay.js"></script>
   <script defer="defer" src="chrome://global/content/editMenuOverlay.js"></script>
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
   <script defer="defer" src="chrome://calendar/content/calendar-error-prompt.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xhtml b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xhtml
--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xhtml
+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xhtml
@@ -15,16 +15,17 @@
 
 <!DOCTYPE html [
   <!ENTITY % dtd1 SYSTEM "chrome://calendar/locale/calendar.dtd" > %dtd1;
   <!ENTITY % dtd2 SYSTEM "chrome://calendar/locale/calendar-event-dialog.dtd" > %dtd2;
 ]>
 <html id="calendar-event-dialog-attendees-v2" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:EventDialog:Attendees"
       orient="vertical"
       lightweightthemes="true"
       scrolling="false"
       style="min-width: 800px; min-height: 500px;">
 <head>
   <title>&invite.title.label;</title>
   <script defer="defer" src="chrome://messenger/content/globalOverlay.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xhtml b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xhtml
--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xhtml
+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.xhtml
@@ -16,16 +16,17 @@
 
 <!DOCTYPE html [
   <!ENTITY % dialogDTD SYSTEM "chrome://calendar/locale/calendar-event-dialog.dtd">
   %dialogDTD;
 ]>
 <html id="calendar-event-dialog-recurrence" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:EventDialog:Recurrence"
       persist="screenX screenY width height"
       lightweightthemes="true"
       scrolling="false">
 <head>
   <title>&recurrence.title.label;</title>
   <link rel="localization" href="calendar/calendar-recurrence-dialog.ftl" />
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-event-dialog-reminder.xhtml b/calendar/base/content/dialogs/calendar-event-dialog-reminder.xhtml
--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.xhtml
+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.xhtml
@@ -12,16 +12,17 @@
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/input-fields.css"?>
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/colors.css"?>
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/themeableDialog.css"?>
 
 <!DOCTYPE window SYSTEM "chrome://calendar/locale/dialogs/calendar-event-dialog-reminder.dtd" >
 
 <window id="calendar-event-dialog-reminder"
         title="&reminderdialog.title;"
+        icon="calendar-general-dialog"
         windowtype="Calendar:EventDialog:Reminder"
         onload="onLoad()"
         persist="screenX screenY width height"
         lightweightthemes="true"
         xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
         xmlns:html="http://www.w3.org/1999/xhtml">
 
 <dialog>
diff --git a/calendar/base/content/dialogs/calendar-event-dialog-timezone.xhtml b/calendar/base/content/dialogs/calendar-event-dialog-timezone.xhtml
--- a/calendar/base/content/dialogs/calendar-event-dialog-timezone.xhtml
+++ b/calendar/base/content/dialogs/calendar-event-dialog-timezone.xhtml
@@ -14,16 +14,17 @@
 <!DOCTYPE html [
   <!ENTITY % dtd1 SYSTEM "chrome://calendar/locale/global.dtd" > %dtd1;
   <!ENTITY % dtd2 SYSTEM "chrome://calendar/locale/calendar.dtd" > %dtd2;
   <!ENTITY % dtd3 SYSTEM "chrome://calendar/locale/calendar-event-dialog.dtd" > %dtd3;
 ]>
 <html id="calendar-event-dialog-timezone" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:EventDialog:Timezone"
       lightweightthemes="true"
       scrolling="false">
 <head>
   <title>&timezone.title.label;</title>
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
   <script defer="defer" src="chrome://calendar/content/widgets/calendar-minimonth.js"></script>
   <script defer="defer" src="chrome://calendar/content/calendar-dialog-utils.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-event-dialog.xhtml b/calendar/base/content/dialogs/calendar-event-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-event-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-event-dialog.xhtml
@@ -25,16 +25,17 @@
     %calendarDTD;
     %eventDialogDTD;
 ]>
 
 <!-- Dialog id is changed during execution to allow different Window-icons
      on this dialog. document.loadOverlay() will not work on this one. -->
 <window id="calendar-event-window"
         title="&event.title.label;"
+        icon="calendar-general-dialog"
         windowtype="Calendar:EventDialog"
         onload="onLoadCalendarItemPanel();"
         onunload="onUnloadCalendarItemPanel();"
         persist="screenX screenY width height"
         lightweightthemes="true"
         xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
         xmlns:html="http://www.w3.org/1999/xhtml">
 
diff --git a/calendar/base/content/dialogs/calendar-ics-file-dialog.xhtml b/calendar/base/content/dialogs/calendar-ics-file-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-ics-file-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-ics-file-dialog.xhtml
@@ -13,16 +13,17 @@
 <?xml-stylesheet type="text/css" href="chrome://calendar/skin/shared/calendar-item-summary.css"?>
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/contextMenu.css"?>
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/themeableDialog.css"?>
 <?xml-stylesheet type="text/css" href="chrome://calendar/skin/shared/dialogs/calendar-ics-file-dialog.css"?>
 
 <html id="calendar-ics-file-dialog" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       lightweightthemes="true"
       style="min-width:42em; min-height:42em;"
       scrolling="false">
 <head>
   <title data-l10n-id="calendar-ics-file-window-title"></title>
   <link rel="localization" href="calendar/calendar-editable-item.ftl" />
   <link rel="localization" href="calendar/calendar-ics-file-dialog.ftl" />
   <script src="chrome://messenger/content/dialogShadowDom.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-invitations-dialog.xhtml b/calendar/base/content/dialogs/calendar-invitations-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-invitations-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-invitations-dialog.xhtml
@@ -10,16 +10,17 @@
 
 <!DOCTYPE html [
   <!ENTITY % dtd1 SYSTEM "chrome://calendar/locale/calendar-invitations-dialog.dtd"> %dtd1;
 ]>
 
 <html id="calendar-invitations-dialog" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       lightweightthemes="true"
       persist="screenX screenY"
       style="min-width: 600px; min-height: 350px;"
       scrolling="false">
 <head>
   <title>&calendar.invitations.dialog.invitations.text;</title>
   <link rel="localization" href="calendar/calendar-invitations-dialog.ftl" />
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-itip-identity-dialog.xhtml b/calendar/base/content/dialogs/calendar-itip-identity-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-itip-identity-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-itip-identity-dialog.xhtml
@@ -9,16 +9,17 @@
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/colors.css"?>
 <?xml-stylesheet type="text/css" href="chrome://messenger/skin/themeableDialog.css"?>
 
 <!DOCTYPE html>
 
 <html xmlns="http://www.w3.org/1999/xhtml"
       xmlns:html="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
+      icon="calendar-general-dialog"
       lightweightthemes="true">
 <head>
   <title data-l10n-id="calendar-itip-identity-dialog-title"></title>
 
   <link rel="localization" href="calendar/calendar-itip-identity-dialog.ftl" />
 
   <script defer="defer" src="chrome://calendar/content/calendar-ui-utils.js"></script>
   <script defer="defer" src="chrome://calendar/content/calendar-itip-identity-dialog.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-migration-dialog.xhtml b/calendar/base/content/dialogs/calendar-migration-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-migration-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-migration-dialog.xhtml
@@ -11,16 +11,17 @@
   <!ENTITY % brandDTD SYSTEM "chrome://branding/locale/brand.dtd">
   %brandDTD;
   <!ENTITY % migrationDtd SYSTEM "chrome://calendar/locale/migration.dtd">
   %migrationDtd;
 ]>
 <html id="migration-wizard" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       branded="true"
       windowtype="Calendar:MigrationWizard"
       scrolling="false">
 <head>
   <title>&migration.title;</title>
   <link rel="localization" href="toolkit/global/wizard.ftl" />
   <script defer="defer" src="chrome://calendar/content/import-export.js"></script>
   <script defer="defer" src="chrome://calendar/content/calendar-migration-dialog.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-occurrence-prompt.xhtml b/calendar/base/content/dialogs/calendar-occurrence-prompt.xhtml
--- a/calendar/base/content/dialogs/calendar-occurrence-prompt.xhtml
+++ b/calendar/base/content/dialogs/calendar-occurrence-prompt.xhtml
@@ -7,16 +7,17 @@
 <?xml-stylesheet href="chrome://messenger/skin/colors.css" type="text/css"?>
 <?xml-stylesheet href="chrome://messenger/skin/themeableDialog.css" type="text/css"?>
 <?xml-stylesheet href="chrome://calendar/skin/shared/calendar-occurrence-prompt.css" type="text/css"?>
 
 <!DOCTYPE html SYSTEM "chrome://calendar/locale/calendar-occurrence-prompt.dtd">
 <html id="calendar-occurrence-prompt" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       lightweightthemes="true"
       scrolling="false">
 <head>
   <title><!-- windowtitle.${itemType}.${action} --></title>
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
   <script defer="defer" src="chrome://calendar/content/calendar-occurrence-prompt.js"></script>
 </head>
 <html:body xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
diff --git a/calendar/base/content/dialogs/calendar-properties-dialog.xhtml b/calendar/base/content/dialogs/calendar-properties-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-properties-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-properties-dialog.xhtml
@@ -15,16 +15,17 @@
     <!ENTITY % dtd1 SYSTEM "chrome://calendar/locale/global.dtd" > %dtd1;
     <!ENTITY % dtd2 SYSTEM "chrome://calendar/locale/calendar.dtd" > %dtd2;
     <!ENTITY % dtd3 SYSTEM "chrome://calendar/locale/calendarCreation.dtd" > %dtd3;
     <!ENTITY % dtd4 SYSTEM "chrome://lightning/locale/lightning.dtd" > %dtd4;
 ]>
 <html id="calendar-properties-dialog" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:PropertiesDialog"
       persist="screenX screenY"
       lightweightthemes="true"
       width="600" height="630">
 <head>
   <title>&calendar.server.dialog.title.edit;</title>
   <script defer="defer" src="chrome://messenger/content/globalOverlay.js"></script>
   <script defer="defer" src="chrome://global/content/editMenuOverlay.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xhtml b/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xhtml
@@ -6,16 +6,17 @@
 <?xml-stylesheet type="text/css" href="chrome://global/skin/global.css"?>
 <?xml-stylesheet type="text/css" href="chrome://calendar/skin/shared/calendar-providerUninstall-dialog.css"?>
 <?xml-stylesheet type="text/css" href="chrome://calendar/skin/shared/widgets/calendar-widgets.css"?>
 
 <!DOCTYPE html SYSTEM "chrome://calendar/locale/provider-uninstall.dtd" >
 <html id="calendar-provider-uninstall-dialog" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:ProviderUninstall"
       width="480" height="320"
       style="min-width:480px;"
       scrolling="false">
 <head>
   <title>&providerUninstall.title;</title>
   <script defer="defer" src="chrome://calendar/content/calendar-ui-utils.js"></script>
   <script defer="defer" src="chrome://calendar/content/calendar-providerUninstall-dialog.js"></script>
diff --git a/calendar/base/content/dialogs/calendar-summary-dialog.xhtml b/calendar/base/content/dialogs/calendar-summary-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-summary-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-summary-dialog.xhtml
@@ -22,19 +22,24 @@
   <!ENTITY % dialogDTD SYSTEM "chrome://calendar/locale/calendar-event-dialog.dtd" >
   <!ENTITY % brandDTD SYSTEM "chrome://branding/locale/brand.dtd" >
   %globalDTD;
   %calendarDTD;
   %dialogDTD;
   %brandDTD;
 ]>
 <!-- id is changed during execution to allow different Window-icons on this dialog. -->
+<!-- Sadly this is wishful thinking since the id is set on the dialog in `setDialogId()`
+     in calendar-dialog-utils.js which has no effect on the window. There they set
+     calendar-event-summary-dialog or calendar-task-summary-dialog.
+     Let's set an icon here which at least works. -->
 <html id="calendar-summary-dialog" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:EventSummaryDialog"
       lightweightthemes="true"
       persist="screenX screenY"
       scrolling="false">
 <head>
   <title><!-- item title --></title>
   <link rel="localization" href="toolkit/global/textActions.ftl" />
   <link rel="localization" href="calendar/calendar-summary-dialog.ftl" />
diff --git a/calendar/base/content/dialogs/calendar-uri-redirect-dialog.xhtml b/calendar/base/content/dialogs/calendar-uri-redirect-dialog.xhtml
--- a/calendar/base/content/dialogs/calendar-uri-redirect-dialog.xhtml
+++ b/calendar/base/content/dialogs/calendar-uri-redirect-dialog.xhtml
@@ -7,16 +7,17 @@
 <?xml-stylesheet href="chrome://messenger/skin/colors.css" type="text/css"?>
 <?xml-stylesheet href="chrome://messenger/skin/themeableDialog.css" type="text/css"?>
 
 <html id="calendar-uri-redirect-dialog" xmlns="http://www.w3.org/1999/xhtml"
       windowtype="Calendar:URIRedirect"
       lightweightthemes="true"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       width="600"
       style="min-width:600px"
       scrolling="false">
 <head>
   <title data-l10n-id="calendar-uri-redirect-window-title"></title>
   <link rel="localization" href="calendar/calendar-uri-redirect-dialog.ftl" />
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
   <script defer="defer" src="chrome://calendar/content/calendar-uri-redirect-dialog.js"></script>
diff --git a/calendar/base/content/dialogs/chooseCalendarDialog.xhtml b/calendar/base/content/dialogs/chooseCalendarDialog.xhtml
--- a/calendar/base/content/dialogs/chooseCalendarDialog.xhtml
+++ b/calendar/base/content/dialogs/chooseCalendarDialog.xhtml
@@ -11,16 +11,17 @@
 <!-- DTD File with all strings specific to the file -->
 <!DOCTYPE window SYSTEM "chrome://calendar/locale/calendar.dtd">
 
 <window id="chooseCalendar"
         title="&calendar.select.dialog.title;"
         windowtype="Calendar:CalendarPicker"
         xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
         xmlns:html="http://www.w3.org/1999/xhtml"
+        icon="calendar-general-dialog"
         onload="setTimeout(loadCalendars, 0);"
         lightweightthemes="true"
         persist="screenX screenY height width">
 <dialog buttons="accept,cancel">
     <script src="chrome://calendar/content/calendar-ui-utils.js"/>
     <script src="chrome://calendar/content/chooseCalendarDialog.js"/>
     <script src="chrome://messenger/content/dialogShadowDom.js"/>
 
diff --git a/calendar/base/content/dialogs/publishDialog.xhtml b/calendar/base/content/dialogs/publishDialog.xhtml
--- a/calendar/base/content/dialogs/publishDialog.xhtml
+++ b/calendar/base/content/dialogs/publishDialog.xhtml
@@ -10,16 +10,17 @@
 
 <!DOCTYPE html [
   <!ENTITY % dtd1 SYSTEM "chrome://calendar/locale/global.dtd" > %dtd1;
   <!ENTITY % dtd2 SYSTEM "chrome://calendar/locale/calendar.dtd" > %dtd2;
 ]>
 <html id="calendar-publishwindow" xmlns="http://www.w3.org/1999/xhtml"
       xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
       xmlns:html="http://www.w3.org/1999/xhtml"
+      icon="calendar-general-dialog"
       windowtype="Calendar:PublishDialog"
       persist="screenX screenY"
       lightweightthemes="true"
       scrolling="false">
 <head>
   <title>&calendar.publish.dialog.title;</title>
   <script defer="defer" src="chrome://messenger/content/dialogShadowDom.js"></script>
   <script defer="defer" src="chrome://calendar/content/publishDialog.js"></script>
diff --git a/mail/installer/package-manifest.in b/mail/installer/package-manifest.in
--- a/mail/installer/package-manifest.in
+++ b/mail/installer/package-manifest.in
@@ -200,19 +200,28 @@
 ; Browser: Hack to get built_in_addons.json packaged
 @RESPATH@/chrome/browser@JAREXT@
 @RESPATH@/chrome/browser.manifest
 @RESPATH@/chrome/messenger@JAREXT@
 @RESPATH@/chrome/messenger.manifest
 @RESPATH@/chrome/pdfjs.manifest
 @RESPATH@/chrome/pdfjs/*
 #ifndef XP_UNIX
-@RESPATH@/chrome/icons/default/abcardWindow.ico
-@RESPATH@/chrome/icons/default/addressbookWindow.ico
-@RESPATH@/chrome/icons/default/messengerWindow.ico
+; These icons are Windows specific and are used in Mozilla platform code
+; to put a specific icon on an application window. If no icon exists,
+; the default icon from the resource in the executable is used.
+; abcardWindow.ico and addressbookWindow.ico are not used any more.
+; @RESPATH@/chrome/icons/default/abcardWindow.ico
+; @RESPATH@/chrome/icons/default/addressbookWindow.ico
+; We're not packaging messengerWindow.ico so the users can install
+; their own icon without it getting overwritten on every install.
+; messengerWindow.ico is not needed since it will default to the standard
+; application icon. We don't package newmail.ico for the same reason.
+; @RESPATH@/chrome/icons/default/messengerWindow.ico
+; We only need icons for compose and calendar alarm window.
 @RESPATH@/chrome/icons/default/msgcomposeWindow.ico
 @RESPATH@/chrome/icons/default/calendar-alarm-dialog.ico
 #elifdef UNIX_BUT_NOT_MAC
 @RESPATH@/chrome/icons/default/*.png
 @RESPATH@/chrome/icons/default/*.svg
 #endif
 
 ; Gloda
diff --git a/mailnews/base/src/nsMessengerWinIntegration.cpp b/mailnews/base/src/nsMessengerWinIntegration.cpp
--- a/mailnews/base/src/nsMessengerWinIntegration.cpp
+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp
@@ -48,16 +48,87 @@ NS_IMPL_ADDREF(nsMessengerWinIntegration
 NS_IMPL_RELEASE(nsMessengerWinIntegration)
 
 NS_INTERFACE_MAP_BEGIN(nsMessengerWinIntegration)
   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMessengerOSIntegration)
   NS_INTERFACE_MAP_ENTRY(nsIMessengerWindowsIntegration)
   NS_INTERFACE_MAP_ENTRY(nsIMessengerOSIntegration)
 NS_INTERFACE_MAP_END
 
+// Adapted from widget/nsBaseWidget.cpp, it's private :-(
+static void ResolveIconName(const nsAString& aIconName,
+                            const nsAString& aIconSuffix, nsIFile** aResult) {
+  *aResult = nullptr;
+  nsCOMPtr<nsIProperties> dirSvc =
+      do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID);
+  if (!dirSvc) return;
+
+  // Check the main app chrome directory.
+  nsCOMPtr<nsIFile> file;
+  dirSvc->Get("AChrom", NS_GET_IID(nsIFile), getter_AddRefs(file));
+  if (!file) return;
+
+  file->Append(u"icons"_ns);
+  file->Append(u"default"_ns);
+  file->Append(aIconName + aIconSuffix);
+  bool readable;
+  if (NS_SUCCEEDED(file->IsReadable(&readable)) && readable) {
+    file.forget(aResult);
+  }
+}
+
+static HICON GetIcon(LPCWSTR idi) {
+  static bool iconsCached = false;
+  static HICON iconApp;
+  static HICON iconBiff;
+
+  if (!iconsCached) {
+    nsCOMPtr<nsIFile> iconAppFile;
+    nsCOMPtr<nsIFile> iconBiffFile;
+
+    ResolveIconName(u"messengerWindow"_ns, u".ico"_ns,
+                    getter_AddRefs(iconAppFile));
+    if (!iconAppFile) {
+      iconApp = ::LoadIcon(::GetModuleHandle(NULL), IDI_APPLICATION);
+    } else {
+      nsAutoString iconAppPath;
+      iconAppFile->GetPath(iconAppPath);
+      ::SetLastError(0);
+      iconApp =
+          (HICON)::LoadImageW(nullptr, (LPCWSTR)iconAppPath.get(), IMAGE_ICON,
+                              ::GetSystemMetrics(SM_CXICON),
+                              ::GetSystemMetrics(SM_CYICON), LR_LOADFROMFILE);
+      if (!iconApp) {
+        iconApp = ::LoadIcon(::GetModuleHandle(NULL), IDI_APPLICATION);
+      }
+    }
+
+    ResolveIconName(u"newmail"_ns, u".ico"_ns, getter_AddRefs(iconBiffFile));
+    if (!iconBiffFile) {
+      iconBiff =
+          ::LoadIcon(::GetModuleHandle(NULL), MAKEINTRESOURCE(IDI_MAILBIFF));
+    } else {
+      nsAutoString iconBiffPath;
+      iconBiffFile->GetPath(iconBiffPath);
+      ::SetLastError(0);
+      iconBiff =
+          (HICON)::LoadImageW(nullptr, (LPCWSTR)iconBiffPath.get(), IMAGE_ICON,
+                              ::GetSystemMetrics(SM_CXICON),
+                              ::GetSystemMetrics(SM_CYICON), LR_LOADFROMFILE);
+      if (!iconBiff) {
+        iconBiff =
+            LoadIcon(::GetModuleHandle(NULL), MAKEINTRESOURCE(IDI_MAILBIFF));
+      }
+    }
+
+    iconsCached = true;
+  }
+  return idi == IDI_APPLICATION ? iconApp : iconBiff;
+}
+
 static HWND hwndForDOMWindow(mozIDOMWindowProxy* window) {
   if (!window) {
     return 0;
   }
   nsCOMPtr<nsPIDOMWindowOuter> pidomwindow = nsPIDOMWindowOuter::From(window);
 
   nsCOMPtr<nsIBaseWindow> ppBaseWindow =
       do_QueryInterface(pidomwindow->GetDocShell());
@@ -210,17 +281,17 @@ nsresult nsMessengerWinIntegration::Hide
   rv = CreateIconWindow();
   NS_ENSURE_SUCCESS(rv, rv);
 
   if (!mTrayIconShown) {
     auto idi = IDI_APPLICATION;
     if (sUnreadCount > 0) {
       idi = MAKEINTRESOURCE(IDI_MAILBIFF);
     }
-    sMailIconData.hIcon = ::LoadIcon(::GetModuleHandle(NULL), idi);
+    sMailIconData.hIcon = GetIcon(idi);
     nsresult rv = SetTooltip();
     NS_ENSURE_SUCCESS(rv, rv);
 
     ::Shell_NotifyIconW(NIM_ADD, &sMailIconData);
     ::Shell_NotifyIconW(NIM_SETVERSION, &sMailIconData);
     mTrayIconShown = true;
   }
   return NS_OK;
@@ -355,17 +426,17 @@ nsresult nsMessengerWinIntegration::Upda
     showTrayIconAlways = false;
   }
   if (sUnreadCount > 0 || showTrayIconAlways) {
     auto idi = IDI_APPLICATION;
     if (sUnreadCount > 0) {
       // Only showing the new mail marker when there are actual unread mail
       idi = MAKEINTRESOURCE(IDI_MAILBIFF);
     }
-    sMailIconData.hIcon = ::LoadIcon(::GetModuleHandle(NULL), idi);
+    sMailIconData.hIcon = GetIcon(idi);
     if (mTrayIconShown) {
       // If the tray icon is already shown, just modify it.
       ::Shell_NotifyIconW(NIM_MODIFY, &sMailIconData);
     } else {
       bool showTrayIcon;
       rv = mPrefBranch->GetBoolPref(SHOW_TRAY_ICON_PREF, &showTrayIcon);
       NS_ENSURE_SUCCESS(rv, rv);
       if (showTrayIcon) {
@@ -373,18 +444,17 @@ nsresult nsMessengerWinIntegration::Upda
         ::Shell_NotifyIconW(NIM_ADD, &sMailIconData);
         ::Shell_NotifyIconW(NIM_SETVERSION, &sMailIconData);
         mTrayIconShown = true;
       }
     }
   } else if (mTrayIconShown) {
     if (sHiddenWindows.Length() > 0) {
       // At least one window is minimized, modify the icon only.
-      sMailIconData.hIcon =
-          ::LoadIcon(::GetModuleHandle(NULL), IDI_APPLICATION);
+      sMailIconData.hIcon = GetIcon(IDI_APPLICATION);
       ::Shell_NotifyIconW(NIM_MODIFY, &sMailIconData);
     } else if (!showTrayIconAlways) {
       // No unread, no need to show the tray icon.
       ::Shell_NotifyIconW(NIM_DELETE, &sMailIconData);
       mTrayIconShown = false;
     }
   }
   return rv;
