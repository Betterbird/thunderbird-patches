# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1697060369 -7200
# Parent  9077da52a35080a6323cb258414b1c145510c82f
Feature: Shift+"Mark Folder Read" also marks sub-folders read.

Requested in https://bugzilla.mozilla.org/show_bug.cgi?id=500762 in 2009.

diff --git a/mail/base/content/about3Pane.js b/mail/base/content/about3Pane.js
--- a/mail/base/content/about3Pane.js
+++ b/mail/base/content/about3Pane.js
@@ -644,17 +644,46 @@ var folderPaneContextMenu = {
       case "folderPaneContext-subscribe":
         topChromeWindow.MsgSubscribe(folder);
         break;
       case "folderPaneContext-newsUnsubscribe":
         topChromeWindow.MsgUnsubscribe([folder]);
         break;
       case "folderPaneContext-markMailFolderAllRead":
       case "folderPaneContext-markNewsgroupAllRead":
-        topChromeWindow.MsgMarkAllRead([folder]);
+        if (event.shiftKey) {
+          // Mark folder and subfolders read.
+          function recurse(f) {
+            let subFolders;
+            try {
+              subFolders = f.subFolders;
+            } catch (ex) {
+              console.error(
+                new Error(
+                  `Unable to access the subfolders of ${f.URI}`,
+                  { cause: ex }
+                )
+              );
+            }
+            if (!subFolders?.length) {
+              return;
+            }
+
+            for (let sf of subFolders) {
+              folders.push(sf);
+              recurse(sf);
+            }
+          }
+
+          let folders = [folder];
+          recurse(folder);
+          topChromeWindow.MsgMarkAllRead(folders);
+        } else {
+          topChromeWindow.MsgMarkAllRead([folder]);
+        }
         break;
       case "folderPaneContext-emptyTrash":
         folderPane.emptyTrash(folder);
         break;
       case "folderPaneContext-emptyJunk":
         folderPane.emptyJunk(folder);
         break;
       case "folderPaneContext-sendUnsentMessages":
