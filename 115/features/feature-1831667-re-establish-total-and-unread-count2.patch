# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1708616347 -3600
# Parent  db6bfb6e5fdb354f62a9ae224267dfcd853ed3fd
Feature: Bug 1831667: Re-establish counts, also show row count if different, take 2.

diff --git a/mail/base/content/about3Pane.js b/mail/base/content/about3Pane.js
--- a/mail/base/content/about3Pane.js
+++ b/mail/base/content/about3Pane.js
@@ -5112,16 +5112,17 @@ var threadPane = {
         break;
       case "expanded":
       case "collapsed":
         if (event.detail == threadTree.selectedIndex) {
           // The selected index hasn't changed, but a collapsed row represents
           // multiple messages, so for our purposes the selection has changed.
           threadTree.dispatchEvent(new CustomEvent("select"));
         }
+        threadPaneHeader.updateStatusBar();
         break;
       case "scroll":
         if (this.isFirstScroll) {
           this.isFirstScroll = false;
           break;
         }
         this.scrollDetected = true;
         break;
@@ -7524,16 +7525,17 @@ var sortController = {
         break;
       default:
         if (event.target.value in Ci.nsMsgViewSortType) {
           this.sortThreadPane(event.target.value);
           threadPane.restoreSortIndicator();
         }
         break;
     }
+    threadPaneHeader.updateStatusBar();
   },
   sortByThread() {
     threadPane.updateListRole(false);
     gViewWrapper.showThreaded = true;
     this.sortThreadPane("byDate");
   },
   sortThreadPane(sortName) {
     let sortType = Ci.nsMsgViewSortType[sortName];
@@ -7764,26 +7766,28 @@ commandController.registerCallback(
 
 commandController.registerCallback(
   "cmd_expandAllThreads",
   () => {
     threadPane.saveSelection();
     gViewWrapper.dbView.doCommand(Ci.nsMsgViewCommandType.expandAll);
     gViewWrapper._threadExpandAll = true;
     threadPane.restoreSelection();
+    threadPaneHeader.updateStatusBar();
   },
   () => !!gViewWrapper?.dbView
 );
 commandController.registerCallback(
   "cmd_collapseAllThreads",
   () => {
     threadPane.saveSelection();
     gViewWrapper.dbView.doCommand(Ci.nsMsgViewCommandType.collapseAll);
     gViewWrapper._threadExpandAll = false;
     threadPane.restoreSelection({ expand: false });
+    threadPaneHeader.updateStatusBar();
   },
   () => !!gViewWrapper?.dbView
 );
 
 function SwitchView(command) {
   // when switching thread views, we might be coming out of quick search
   // or a message view.
   // first set view picker to all
