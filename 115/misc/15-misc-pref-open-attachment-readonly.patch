# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1709828387 -3600
# Parent  c697ac2867d6646297c042c67e329d2c6998d3ce
Misc: Introduce pref mail.download.open_attachments_readonly.

diff --git a/mail/app/profile/all-thunderbird.js b/mail/app/profile/all-thunderbird.js
--- a/mail/app/profile/all-thunderbird.js
+++ b/mail/app/profile/all-thunderbird.js
@@ -1442,8 +1442,9 @@ pref("ui.prefersReducedMotion", 0);
 pref("mail.multiselect_message_shows_current", false);
 pref("mail.startupMinimized", false);
 // Avoid .part files on desktop when opening attachments from compose window.
 pref("browser.download.start_downloads_in_tmp_dir", true);
+pref("mail.download.open_attachments_readonly", true);
 
 // IMAP-JS disabled, Bug 1707547.
 pref("mailnews.imap.jsmodule", false);
 
diff --git a/mail/modules/AttachmentInfo.sys.mjs b/mail/modules/AttachmentInfo.sys.mjs
--- a/mail/modules/AttachmentInfo.sys.mjs
+++ b/mail/modules/AttachmentInfo.sys.mjs
@@ -309,9 +309,11 @@ export class AttachmentInfo {
 
         await saveToFile(tempFile.path, true);
         // Before opening from the temp dir, make the file read-only so that
         // users don't edit and lose their edits...
-        await IOUtils.setPermissions(tempFile.path, 0o400); // Set read-only
+        if (Services.prefs.getBoolPref("mail.download.open_attachments_readonly", true)) {
+          await IOUtils.setPermissions(tempFile.path, 0o400); // Set read-only
+        }
         this._openFile(mimeInfo, tempFile);
       };
 
       let openLocalFile = mimeInfo => {
