# HG changeset patch
# User welpy-cw <h.w.forms@arcor.de>
# Date 1699895693 -3600
# Parent  b1971eff3b246b551cfbc7069d28c62e1c7f1b1d
Bug 1864339 - Fix hdrForFirstSelectedMessage for multi-folder views. r=mkmelin

diff --git a/mailnews/base/src/nsMsgSearchDBView.cpp b/mailnews/base/src/nsMsgSearchDBView.cpp
--- a/mailnews/base/src/nsMsgSearchDBView.cpp
+++ b/mailnews/base/src/nsMsgSearchDBView.cpp
@@ -1059,27 +1059,19 @@ NS_IMETHODIMP nsMsgSearchDBView::Sort(ns
   NS_ENSURE_SUCCESS(rv, rv);
   return rv;
 }
 
 // If nothing selected, return an NS_ERROR.
 NS_IMETHODIMP
 nsMsgSearchDBView::GetHdrForFirstSelectedMessage(nsIMsgDBHdr** hdr) {
   NS_ENSURE_ARG_POINTER(hdr);
-  int32_t index;
-
-  if (!mTreeSelection) {
-    // We're in standalone mode, so use the message view index to get the
-    // header. We can't use the key here because we don't have an m_db.
-    index = m_currentlyDisplayedViewIndex;
-  } else {
-    nsresult rv = mTreeSelection->GetCurrentIndex(&index);
-    NS_ENSURE_SUCCESS(rv, rv);
-  }
-
+  nsMsgViewIndex index;
+  nsresult rv = GetViewIndexForFirstSelectedMsg(&index);
+  NS_ENSURE_SUCCESS(rv, rv);
   return GetMsgHdrForViewIndex(index, hdr);
 }
 
 NS_IMETHODIMP
 nsMsgSearchDBView::OpenWithHdrs(nsIMsgEnumerator* aHeaders,
                                 nsMsgViewSortTypeValue aSortType,
                                 nsMsgViewSortOrderValue aSortOrder,
                                 nsMsgViewFlagsTypeValue aViewFlags,
