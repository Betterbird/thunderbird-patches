# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1689624403 -7200
# Parent  a3df5d1ac3e9013621d2fa202a964acdf988cd93
Bug 1843833 - Restore invalidating the thread tree when setting the subject in PGP code.

diff --git a/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js b/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js
--- a/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js
+++ b/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js
@@ -753,16 +753,22 @@ Enigmail.hdrView = {
     );
     let hadRe = newSubject != subject;
 
     // Update the message.
     gMessage.subject = newSubject;
     if (hadRe) {
       gMessage.flags |= Ci.nsMsgMessageFlags.HasRe;
     }
+    // Update the tree.
+    let index = parent.threadTree?.view?.selection?.currentIndex;
+    if (typeof index === "number") {
+      parent.threadTree.invalidateRow(index);
+    }
+
   },
 
   updateHdrBox(header, value) {
     let e = document.getElementById("expanded" + header + "Box");
     if (e) {
       e.headerValue = value;
     }
   },
