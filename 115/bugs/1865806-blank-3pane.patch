# HG changeset patch
# User Magnus Melin <mkmelin+mozilla@iki.fi>
# Date 1701014137 -3600
# Node ID aebcb6b00fdc6ce7dc7d2e5a1e66fc976b119c36
# Parent  e1dc824fd405107f97fd0ea4c53bd18de3625441
Bug 1865806 - Prevent blank 3pane when starting up with unsent messages in outbox. r=freaktechnik

Differential Revision: https://phabricator.services.mozilla.com/D194211

diff --git a/mail/base/content/about3Pane.js b/mail/base/content/about3Pane.js
--- a/mail/base/content/about3Pane.js
+++ b/mail/base/content/about3Pane.js
@@ -4638,17 +4638,17 @@ var threadPane = {
    */
   isFirstScroll: true,
 
   columns: getDefaultColumns(gFolder),
 
   cardColumns: getDefaultColumnsForCardsView(gFolder),
 
   async init() {
-    quickFilterBar.init();
+    await quickFilterBar.init();
 
     this.setUpTagStyles();
     Services.prefs.addObserver("mailnews.tags.", this);
     Services.prefs.addObserver("mail.pane_config.multiline_all", this);
 
     Services.obs.addObserver(this, "addrbook-displayname-changed");
 
     // Ensure TreeView and its classes are properly defined.
diff --git a/mail/base/content/quickFilterBar.js b/mail/base/content/quickFilterBar.js
--- a/mail/base/content/quickFilterBar.js
+++ b/mail/base/content/quickFilterBar.js
@@ -49,17 +49,18 @@ var quickFilterBar = {
    * The UI element that last triggered a search. This can be used to avoid
    * updating the element when a search returns - in particular the text box,
    * which the user may still be typing into.
    *
    * @type {Element}
    */
   activeElement: null,
 
-  init() {
+  async init() {
+    await window.customElements.whenDefined("search-bar");
     this._bindUI();
     this.updateRovingTab();
 
     // Enable any filters set by the user.
     // If keep filters applied/sticky setting is enabled, enable sticky.
     let xulStickyVal = Services.xulStore.getValue(
       XULSTORE_URL,
       "quickFilterBarSticky",
