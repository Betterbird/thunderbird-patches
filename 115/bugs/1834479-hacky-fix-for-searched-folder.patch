# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Parent  356980401378a249b53493f0c3a59cece9c18da6
Bug 1834479 - Hacky fix to show searched folders at startup.

diff --git a/mail/base/content/about3Pane.js b/mail/base/content/about3Pane.js
--- a/mail/base/content/about3Pane.js
+++ b/mail/base/content/about3Pane.js
@@ -897,16 +897,29 @@ var folderPane = {
           }
           let row = folderPane._createFolderRow(this.name, folder);
           this.containerList.appendChild(row);
           folderType.folderURI = folder.URI;
           folderType.list = row.childList;
 
           // Display the searched folders for this type.
           let wrappedFolder = VirtualFolderHelper.wrapVirtualFolder(folder);
+
+          // Total hack to get unified folders up.
+          let inspector;
+          while (wrappedFolder.searchFolders.length == 0) {
+            if (!inspector) {
+              inspector = Cc["@mozilla.org/jsinspector;1"].createInstance(Ci.nsIJSInspector);
+            }
+            let sleep = new Promise(r => setTimeout(r, 100));
+            sleep.then(() => inspector.exitNestedEventLoop());
+            inspector.enterNestedEventLoop(0);
+            console.log("init() for smart folders had to wait for searchFolders");
+          }
+
           for (let searchFolder of wrappedFolder.searchFolders) {
             if (searchFolder != folder) {
               this._addSearchedFolder(
                 folderType,
                 folderPane._getNonGmailParent(searchFolder),
                 searchFolder
               );
             }
