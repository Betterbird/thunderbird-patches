# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Parent  438df1e11fd4d4f4e3d4639a4f682b4926018307
Bug 1829370 - On Linux, allow add-on installation even from non-focused notification panel as a workaround also for ChromeOS.

diff --git a/mail/modules/GlobalPopupNotifications.jsm b/mail/modules/GlobalPopupNotifications.jsm
--- a/mail/modules/GlobalPopupNotifications.jsm
+++ b/mail/modules/GlobalPopupNotifications.jsm
@@ -4,16 +4,19 @@
 
 /** This file is a semi-fork of PopupNotifications.jsm */
 
 var EXPORTED_SYMBOLS = ["PopupNotifications"];
 
 const { PromiseUtils } = ChromeUtils.importESModule(
   "resource://gre/modules/PromiseUtils.sys.mjs"
 );
+var { AppConstants } = ChromeUtils.importESModule(
+  "resource://gre/modules/AppConstants.sys.mjs"
+);
 
 const NOTIFICATION_EVENT_DISMISSED = "dismissed";
 const NOTIFICATION_EVENT_REMOVED = "removed";
 const NOTIFICATION_EVENT_SHOWING = "showing";
 const NOTIFICATION_EVENT_SHOWN = "shown";
 const NOTIFICATION_EVENT_SWAPPING = "swapping";
 
 const ICON_SELECTOR = ".notification-anchor-icon";
@@ -1518,17 +1521,22 @@ PopupNotifications.prototype = {
 
     if (type == "buttoncommand" || type == "secondarybuttoncommand") {
       if (Services.focus.activeWindow != this.window) {
         Services.console.logStringMessage(
           "PopupNotifications._onButtonEvent: " +
             "Button click happened before the window was focused"
         );
         this.window.focus();
-        return;
+        if (AppConstants.platform != "linux") {
+          Services.console.logStringMessage(
+            "PopupNotifications._onButtonEvent: Returning."
+          );
+          return;
+        }
       }
 
       let timeSinceShown =
         this.window.performance.now() - notification.timeShown;
       if (timeSinceShown < this.buttonDelay) {
         Services.console.logStringMessage(
           "PopupNotifications._onButtonEvent: " +
             "Button click happened before the security delay: " +
