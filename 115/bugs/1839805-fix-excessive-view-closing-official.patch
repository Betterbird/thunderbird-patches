# HG changeset patch
# User Geoff Lankow <geoff@darktrojan.net>
# Date 1690882532 -7200
# Parent  a8f19a189ee56ebf6324a9fc43c91c2d72915fe5
Bug 1839805 - Don't call `onLeavingFolder` when displaying a new message in the preview pane.

diff --git a/mail/base/content/aboutMessage.js b/mail/base/content/aboutMessage.js
--- a/mail/base/content/aboutMessage.js
+++ b/mail/base/content/aboutMessage.js
@@ -194,18 +194,20 @@ function displayMessage(uri, viewWrapper
   // Clear the state flags, if this window is re-used.
   window.msgLoaded = false;
   window.msgLoading = false;
 
   // Clean up existing objects before starting again.
   ClearPendingReadTimer();
   gMessage = null;
   if (gViewWrapper && viewWrapper != gViewWrapper) {
-    // Don't clean up gViewWrapper if we're going to reuse it.
-    gViewWrapper?.close();
+    // Don't clean up gViewWrapper if we're going to reuse it. If we're inside
+    // about:3pane, close the view wrapper, but don't call `onLeavingFolder`,
+    // because about:3pane will do that if we're actually leaving the folder.
+    gViewWrapper?.close(parent != top);
     gViewWrapper = null;
   }
   gDBView = null;
 
   gMessageURI = uri;
   ClearCurrentHeaders();
 
   if (!uri) {
