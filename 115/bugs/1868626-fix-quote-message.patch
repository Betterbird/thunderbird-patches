# HG changeset patch
# User Geoff Lankow <geoff@darktrojan.net>
# Date 1707819061 0
# Node ID 48f0516a4fdd9dc4bb1ffdd9649321ea666c294a
# Parent  5e7af1952b62c8424e2cd252797adacec918fc65
Bug 1868626 - Fix Quote Message so it works with messages open in tabs. r=aleca

Differential Revision: https://phabricator.services.mozilla.com/D201636

diff --git a/mail/components/compose/content/MsgComposeCommands.js b/mail/components/compose/content/MsgComposeCommands.js
--- a/mail/components/compose/content/MsgComposeCommands.js
+++ b/mail/components/compose/content/MsgComposeCommands.js
@@ -1574,17 +1574,17 @@ function GetSelectedMessages() {
   let mailWindow = Services.wm.getMostRecentWindow("mail:3pane");
   if (!mailWindow) {
     return null;
   }
   let tab = mailWindow.document.getElementById("tabmail").currentTabInfo;
   if (tab.mode.name == "mail3PaneTab" && tab.message) {
     return tab.chromeBrowser.contentWindow?.gDBView?.getURIsForSelection();
   } else if (tab.mode.name == "mailMessageTab") {
-    return [tab.messageURI];
+    return [tab.chromeBrowser.contentWindow.gMessageURI];
   }
   return null;
 }
 
 function SetupCommandUpdateHandlers() {
   top.controllers.appendController(defaultController);
   gAttachmentBucket.controllers.appendController(attachmentBucketController);
 

