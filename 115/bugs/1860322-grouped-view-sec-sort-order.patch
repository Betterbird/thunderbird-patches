# HG changeset patch
# User welpy-cw <h.w.forms@arcor.de>
# Date 1699009479 -3600
# Node ID ecf34cefd7ef5215693af63219eb4e1e87691f5c
# Parent  7ad7c6fa547f7bb35b16a1fb9b986456f568c68a
Bug 1860322 - Disregard secondary sort order for Grouped By views. r=darktrojan

Differential Revision: https://phabricator.services.mozilla.com/D191534

diff --git a/mail/modules/DBViewWrapper.jsm b/mail/modules/DBViewWrapper.jsm
--- a/mail/modules/DBViewWrapper.jsm
+++ b/mail/modules/DBViewWrapper.jsm
@@ -1126,21 +1126,23 @@ DBViewWrapper.prototype = {
     this.__viewFlags = null;
 
     let dbView = Cc[dbviewContractId].createInstance(Ci.nsIMsgDBView);
     dbView.init(
       this.listener.messenger,
       this.listener.msgWindow,
       this.listener.threadPaneCommandUpdater
     );
-    // use the least-specific sort so we can clock them back through to build up
-    //  the correct sort order...
-    let [sortType, sortOrder, sortCustomCol] = this._getSortDetails(
-      this._sort.length - 1
-    );
+    // Excluding Group By views, use the least-specific sort so we can clock
+    // them back through to build up the correct sort order,
+    let index =
+      viewFlags & Ci.nsMsgViewFlagsType.kGroupBySort
+        ? 0
+        : this._sort.length - 1;
+    let [sortType, sortOrder, sortCustomCol] = this._getSortDetails(index);
     let outCount = {};
     // when the underlying folder is a single real folder (virtual or no), we
     //  tell the view about the underlying folder.
     if (this.isSingleFolder) {
       // If the folder is virtual, m_viewFolder needs to be set before the
       //  folder is opened, otherwise persisted sort info will not be restored
       //  from the right dbFolderInfo. The use case is for a single folder
       //  backed saved search. Currently, sort etc. changes in quick filter are
