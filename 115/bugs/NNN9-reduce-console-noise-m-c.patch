# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1706199666 -3600
# Parent  28faf3e4992d44e028436ae127b722f86907d21d
NNN9 - Suppress unneeded logging to the error console.

diff --git a/toolkit/components/extensions/ExtensionChild.sys.mjs b/toolkit/components/extensions/ExtensionChild.sys.mjs
--- a/toolkit/components/extensions/ExtensionChild.sys.mjs
+++ b/toolkit/components/extensions/ExtensionChild.sys.mjs
@@ -667,16 +667,21 @@ class ProxyAPIImplementation extends Sch
       return;
     }
 
     let id = map.listeners.get(listener);
     map.listeners.delete(listener);
     map.ids.delete(id);
     map.removedIds.add(id);
 
+    // The following call throws if there is no actor.
+    // No benefit in calling it.
+    if (!this.childApiManager.conduit.actor) {
+      return;
+    }
     this.childApiManager.conduit.sendRemoveListener({
       childId: this.childApiManager.id,
       listenerId: id,
       path: this.path,
       alreadyLogged: this.alreadyLogged,
     });
   }
 
diff --git a/toolkit/components/extensions/ExtensionParent.sys.mjs b/toolkit/components/extensions/ExtensionParent.sys.mjs
--- a/toolkit/components/extensions/ExtensionParent.sys.mjs
+++ b/toolkit/components/extensions/ExtensionParent.sys.mjs
@@ -317,17 +317,19 @@ const ProxyMessenger = {
     }
 
     return sender;
   },
 
   getTopBrowsingContextId(tabId) {
     // If a tab alredy has content scripts, no need to check private browsing.
     let tab = apiManager.global.tabTracker.getTab(tabId, null);
-    if (!tab || (tab.browser || tab).getAttribute("pending") === "true") {
+    // tab.getAttribute("pending") throws, so the following doesn't work:
+    // if (!tab || (tab.browser || tab).getAttribute("pending") === "true") {
+    if (!tab || !tab.browser || tab.browser.getAttribute("pending") === "true") {
       // No receivers in discarded tabs, so bail early to keep the browser lazy.
       throw new ExtensionError(ERROR_NO_RECEIVERS);
     }
     let browser = tab.linkedBrowser || tab.browser;
     return browser.browsingContext.id;
   },
 
   // TODO: Rework/simplify this and getSender/getTopBC after bug 1580766.
