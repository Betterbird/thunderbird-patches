# HG changeset patch
# User Brendan Abolivier <brendan@thunderbird.net>
# Date 1701234976 0
# Node ID 88a0564288b88b140ea36f5457027238ee8d7c86
# Parent  59d9a28f7c79a5bb34a6383cb1177a242a5c13dd
Bug 1844664 - Keep track of the command when calling ApplyCommandToIndices on nsMsgSearchDBView for a smart folder. r=mkmelin

Differential Revision: https://phabricator.services.mozilla.com/D194651

diff --git a/mailnews/base/src/nsMsgSearchDBView.cpp b/mailnews/base/src/nsMsgSearchDBView.cpp
--- a/mailnews/base/src/nsMsgSearchDBView.cpp
+++ b/mailnews/base/src/nsMsgSearchDBView.cpp
@@ -819,16 +819,23 @@ nsresult nsMsgSearchDBView::RemoveByInde
       }
     }
   }
 
   m_folders.RemoveObjectAt(index);
   return nsMsgDBView::RemoveByIndex(index);
 }
 
+NS_IMETHODIMP nsMsgSearchDBView::ApplyCommandToIndices(
+    nsMsgViewCommandTypeValue command,
+    nsTArray<nsMsgViewIndex> const& selection) {
+  mCommand = command;
+  return nsMsgDBView::ApplyCommandToIndices(command, selection);
+}
+
 nsresult nsMsgSearchDBView::DeleteMessages(
     nsIMsgWindow* window, nsTArray<nsMsgViewIndex> const& selection,
     bool deleteStorage) {
   nsresult rv = GetFoldersAndHdrsForSelection(selection);
   NS_ENSURE_SUCCESS(rv, rv);
   if (mDeleteModel != nsMsgImapDeleteModels::MoveToTrash) deleteStorage = true;
 
   if (mDeleteModel != nsMsgImapDeleteModels::IMAPDelete) m_deletingRows = true;
diff --git a/mailnews/base/src/nsMsgSearchDBView.h b/mailnews/base/src/nsMsgSearchDBView.h
--- a/mailnews/base/src/nsMsgSearchDBView.h
+++ b/mailnews/base/src/nsMsgSearchDBView.h
@@ -79,16 +79,20 @@ class nsMsgSearchDBView : public nsMsgGr
 
   virtual nsCOMArray<nsIMsgFolder>* GetFolders() override;
   virtual nsresult GetFolderFromMsgURI(const nsACString& aMsgURI,
                                        nsIMsgFolder** aFolder) override;
 
   NS_IMETHOD GetThreadContainingMsgHdr(nsIMsgDBHdr* msgHdr,
                                        nsIMsgThread** pThread) override;
 
+  NS_IMETHOD ApplyCommandToIndices(
+      nsMsgViewCommandTypeValue command,
+      nsTArray<nsMsgViewIndex> const& selection) override;
+
  protected:
   virtual ~nsMsgSearchDBView();
   virtual void InternalClose() override;
   virtual nsresult HashHdr(nsIMsgDBHdr* msgHdr, nsString& aHashKey) override;
   virtual nsresult ListIdsInThread(nsIMsgThread* threadHdr,
                                    nsMsgViewIndex startOfThreadViewIndex,
                                    uint32_t* pNumListed) override;
   nsresult FetchLocation(int32_t aRow, nsAString& aLocationString);

