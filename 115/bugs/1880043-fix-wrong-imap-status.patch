# HG changeset patch
# User Gene Smith <gds@chartertn.net>
# Date 1709585026 -3600
# Parent  e95c85e01bd4ee6e560f0d11a8c29cb684da74af
Bug 1880043 - fix wrong IMAP status messages.

diff --git a/mailnews/imap/src/nsImapMailFolder.cpp b/mailnews/imap/src/nsImapMailFolder.cpp
--- a/mailnews/imap/src/nsImapMailFolder.cpp
+++ b/mailnews/imap/src/nsImapMailFolder.cpp
@@ -6279,19 +6279,20 @@ nsImapMailFolder::PercentProgress(nsIIma
 
           if (!aFmtStringName.IsEmpty()) {
             // There's a progress message to format (the progress messages are
             // all localized and expect three params).
             nsAutoString current;
             current.AppendInt(aCurrentProgress);
             nsAutoString expected;
             expected.AppendInt(aMaxProgress);
-            nsAutoString mailbox(aMailboxName);
-            AutoTArray<nsString, 3> params = {current, expected, mailbox};
-
+            // Use the localized name and not the the standard IMAP name.
+            nsAutoString prettyName;
+            GetPrettyName(prettyName);
+            AutoTArray<nsString, 3> params = {current, expected, prettyName};
             nsCOMPtr<nsIStringBundle> bundle;
             nsresult rv = IMAPGetStringBundle(getter_AddRefs(bundle));
             NS_ENSURE_SUCCESS(rv, rv);
 
             nsString progressText;
             rv = bundle->FormatStringFromName(
                 PromiseFlatCString(aFmtStringName).get(), params, progressText);
             NS_ENSURE_SUCCESS(rv, rv);
diff --git a/mailnews/imap/src/nsImapProtocol.cpp b/mailnews/imap/src/nsImapProtocol.cpp
--- a/mailnews/imap/src/nsImapProtocol.cpp
+++ b/mailnews/imap/src/nsImapProtocol.cpp
@@ -2859,21 +2859,26 @@ void nsImapProtocol::ProcessSelectedStat
         case nsIImapUrl::nsImapMsgPreview: {
           nsCString messageIdString;
           m_runningUrl->GetListOfMessageIds(messageIdString);
           // we don't want to send the flags back in a group
           if (HandlingMultipleMessages(messageIdString) ||
               m_imapAction == nsIImapUrl::nsImapMsgDownloadForOffline ||
               m_imapAction == nsIImapUrl::nsImapMsgPreview) {
             // multiple messages, fetch them all
-            SetProgressString(IMAP_MESSAGES_STRING_INDEX);
-
-            m_progressCurrentNumber[m_stringIndex] = 0;
-            m_progressExpectedNumber =
-                CountMessagesInIdString(messageIdString.get());
+            if (m_imapAction != nsIImapUrl::nsImapMsgDownloadForOffline) {
+              // Autosync does its own progress. Don't do progress here.
+              // Avoids lots of "1 of 1", "1 of 3" etc. interspersed with
+              // autosync progress.
+              SetProgressString(IMAP_MESSAGES_STRING_INDEX);
+
+              m_progressCurrentNumber[m_stringIndex] = 0;
+              m_progressExpectedNumber =
+                  CountMessagesInIdString(messageIdString.get());
+            }
 
             FetchMessage(messageIdString,
                          (m_imapAction == nsIImapUrl::nsImapMsgPreview)
                              ? kBodyStart
                              : kEveryThingRFC822Peek);
             if (m_imapAction == nsIImapUrl::nsImapMsgPreview)
               HeaderFetchCompleted();
             SetProgressString(IMAP_EMPTY_STRING_INDEX);
