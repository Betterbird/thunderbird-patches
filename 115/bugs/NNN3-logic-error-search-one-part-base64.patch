# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1700989592 -3600
# Parent  1d238035abb30045f1ce7b5da3eadd4c28756a53
Bug NNN3 - Fix logic error in searching one-part base64 messages.

diff --git a/mailnews/search/src/nsMsgBodyHandler.cpp b/mailnews/search/src/nsMsgBodyHandler.cpp
--- a/mailnews/search/src/nsMsgBodyHandler.cpp
+++ b/mailnews/search/src/nsMsgBodyHandler.cpp
@@ -116,23 +116,20 @@ int32_t nsMsgBodyHandler::GetNextLine(ns
 
     if (length < 0) break;  // eof in
 
     outLength = ApplyTransformations(nextLine, length, eatThisLine, buf);
   }
 
   if (outLength < 0) return -1;  // eof out
 
-  // For non-multipart messages, the entire message minus headers is encoded
-  // ApplyTransformations can only decode a part
-  if (!m_isMultipart && m_base64part) {
+  // For non-multipart messages, the entire message minus headers is encoded.
+  if (!m_isMultipart && !m_partIsSMIME && m_base64part) {
     Base64Decode(buf);
     m_base64part = false;
-    // And reapply our transformations...
-    outLength = ApplyTransformations(buf, buf.Length(), eatThisLine, buf);
   }
 
   // Process aggregated HTML.
   if (!m_isMultipart && m_partIsHtml) {
     StripHtml(buf);
     outLength = buf.Length();
   }
 
