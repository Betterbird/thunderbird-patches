# HG changeset patch
# User Magnus Melin <mkmelin+mozilla@iki.fi>
# Date 1703499703 -7200
# Node ID 190038b76c6e97bb6a292f395360a91000202dcc
# Parent  a6acbb8140388dc44b2fc10132e144ce351a8bb7
Bug 1868474 - Fix issue that prevented e-mail to folder using Message > Move to, if you click on link or text in e-mail first. r=freaktechnik

Differential Revision: https://phabricator.services.mozilla.com/D196410

diff --git a/mail/base/content/mailCommon.js b/mail/base/content/mailCommon.js
--- a/mail/base/content/mailCommon.js
+++ b/mail/base/content/mailCommon.js
@@ -175,17 +175,17 @@ var commandController = {
      * Moves the selected messages to the destination folder.
      *
      * @param {nsIMsgFolder} destFolder - the destination folder
      */
     cmd_moveMessage(destFolder) {
       if (parent.location.href == "about:3pane") {
         // If we're in about:message inside about:3pane, it's the parent
         // window that needs to advance to the next message.
-        parent.commandController.doCommand("cmd_moveMessage");
+        parent.commandController.doCommand("cmd_moveMessage", destFolder);
         return;
       }
       dbViewWrapperListener.threadPaneCommandUpdater.updateNextMessageAfterDelete();
       gViewWrapper.dbView.doCommandWithFolder(
         Ci.nsMsgViewCommandType.moveMessages,
         destFolder
       );
       Services.prefs.setStringPref(
@@ -568,17 +568,16 @@ var commandController = {
       case "cmd_tag8":
       case "cmd_tag9":
       case "cmd_addTag":
       case "cmd_removeTags":
       case "cmd_toggleTag":
       case "cmd_toggleRead":
       case "cmd_markReadByDate":
       case "cmd_markAsFlagged":
-      case "cmd_moveMessage":
       case "cmd_applyFiltersToSelection":
         return numSelectedMessages >= 1 && !isDummyMessage;
       case "cmd_copyDecryptedTo": {
         let showDecrypt = numSelectedMessages > 1;
         if (numSelectedMessages == 1 && !isDummyMessage) {
           let msgURI = gDBView.URIForFirstSelectedMessage;
           if (msgURI) {
             showDecrypt =
@@ -641,16 +640,19 @@ var commandController = {
       case "cmd_archive":
         return (
           !isDummyMessage &&
           MessageArchiver.canArchive(
             gDBView.getSelectedMsgHdrs(),
             gViewWrapper.isSingleFolder
           )
         );
+      case "cmd_moveMessage": {
+        return canMove();
+      }
       case "cmd_moveToFolderAgain": {
         // Disable "Move to <folder> Again" for news and other read only
         // folders since we can't really move messages from there - only copy.
         let canMoveAgain = numSelectedMessages >= 1;
         if (Services.prefs.getBoolPref("mail.last_msg_movecopy_was_move")) {
           canMoveAgain = canMove() && !isNewsgroup();
         }
         if (canMoveAgain) {

