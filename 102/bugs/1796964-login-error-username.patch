# HG changeset patch
# User Ping Chen <remotenonsense@gmail.com>
# Date 1666731257 -7200
# Parent  a81adb7d8e24768455f52fe1a236325f389054ef
Bug 1796964 - Show username in auth failure dialog in nntp-js.

diff --git a/mailnews/base/src/MailAuthenticator.jsm b/mailnews/base/src/MailAuthenticator.jsm
--- a/mailnews/base/src/MailAuthenticator.jsm
+++ b/mailnews/base/src/MailAuthenticator.jsm
@@ -346,16 +346,27 @@ class IncomingServerAuthenticator extend
   }
 }
 
 /**
  * Collection of helper functions for authenticating a NNTP connection.
  * @extends {IncomingServerAuthenticator}
  */
 class NntpAuthenticator extends IncomingServerAuthenticator {
+  /**
+   * @type string - NNTP server has no userName pref, need to pass it in.
+   */
+  get username() {
+    return this._username;
+  }
+
+  set username(value) {
+    this._username = value;
+  }
+
   promptAuthFailed() {
     return this._promptAuthFailed(null, this._server.prettyName);
   }
 }
 
 /**
  * Collection of helper functions for authenticating a POP connection.
  * @extends {IncomingServerAuthenticator}
diff --git a/mailnews/news/src/NntpClient.jsm b/mailnews/news/src/NntpClient.jsm
--- a/mailnews/news/src/NntpClient.jsm
+++ b/mailnews/news/src/NntpClient.jsm
@@ -742,16 +742,17 @@ class NntpClient {
       );
       if (!gotPassword) {
         this._actionDone(Cr.NS_ERROR_ABORT);
         return;
       }
     }
     this._sendCommand(`AUTHINFO user ${this._newsFolder.groupUsername}`, true);
     this._nextAction = this._actionAuthResult;
+    this._authenticator.username = this._newsFolder.groupUsername;
   }
 
   /**
    * Send `AUTHINFO pass <password>` to the server.
    */
   _actionAuthPassword() {
     this._sendCommand(`AUTHINFO pass ${this._newsFolder.groupPassword}`, true);
     this._nextAction = this._actionAuthResult;
