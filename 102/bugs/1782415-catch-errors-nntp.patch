
# HG changeset patch
# User Ping Chen <remotenonsense@gmail.com>
# Date 1665855482 -7200
# Node ID 454fb2cb9cb88c722f500ce5d418cca9118b3ca2
# Parent  5941912db46f553bcfc296b4df21cd49ec90104f
Bug 1782415 - Catch all errors when handling server responses in NntpClient.jsm. r=mkmelin

Differential Revision: https://phabricator.services.mozilla.com/D153420

diff --git a/mailnews/news/src/NntpClient.jsm b/mailnews/news/src/NntpClient.jsm
--- a/mailnews/news/src/NntpClient.jsm
+++ b/mailnews/news/src/NntpClient.jsm
@@ -185,17 +185,22 @@ class NntpClient {
               this._logger.error(e);
             }
           }
           this._actionDone(Cr.NS_ERROR_FAILURE);
           return;
         }
     }
 
-    this._nextAction?.(res);
+    try {
+      this._nextAction?.(res);
+    } catch (e) {
+      this._logger.error(`Failed to process server response ${res}.`, e);
+      this._actionDone(Cr.NS_ERROR_FAILURE);
+    }
   };
 
   /**
    * The error event handler.
    * @param {TCPSocketErrorEvent} event - The error event.
    */
   _onError = event => {
     this._logger.error(event, event.name, event.message, event.errorCode);
