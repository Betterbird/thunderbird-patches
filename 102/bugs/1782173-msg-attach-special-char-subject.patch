# HG changeset patch
# User Ping Chen <remotenonsense@gmail.com>
# Date 1665084129 -7200
# Parent  1be9f00816af78777788f38e10039e2cafebc826
Bug 1782173 - Fix forwarding msg with special characters in subject.

diff --git a/mail/components/compose/content/MsgComposeCommands.js b/mail/components/compose/content/MsgComposeCommands.js
--- a/mail/components/compose/content/MsgComposeCommands.js
+++ b/mail/components/compose/content/MsgComposeCommands.js
@@ -7607,17 +7607,17 @@ function FileToAttachment(file) {
 async function messageAttachmentToFile(attachment) {
   let pathTempDir = PathUtils.join(
     PathUtils.tempDir,
     "pid-" + Services.appinfo.processID
   );
   await IOUtils.makeDirectory(pathTempDir, { permissions: 0o700 });
   let pathTempFile = await IOUtils.createUniqueFile(
     pathTempDir,
-    attachment.name,
+    encodeURIComponent(attachment.name),
     0o600
   );
   let tempFile = Cc["@mozilla.org/file/local;1"].createInstance(Ci.nsIFile);
   tempFile.initWithPath(pathTempFile);
   let extAppLauncher = Cc[
     "@mozilla.org/uriloader/external-helper-app-service;1"
   ].getService(Ci.nsPIExternalAppLauncher);
   extAppLauncher.deleteTemporaryFileOnExit(tempFile);
