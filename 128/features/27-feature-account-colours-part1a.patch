# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1717832032 -7200
# Parent  b6935ede6bdf588321e691257c5ea56aade6af19
Feature: Account colours, part 1: Adjustments

diff --git a/mailnews/base/prefs/content/AccountManager.js b/mailnews/base/prefs/content/AccountManager.js
--- a/mailnews/base/prefs/content/AccountManager.js
+++ b/mailnews/base/prefs/content/AccountManager.js
@@ -1935,8 +1935,12 @@ var gAccountTree = {
       // Add icons based on account type.
       if (server) {
         treeitem.dataset.serverKey = server.key;
         treeitem.classList.add("serverType-" + server.type);
+        const color = server.RGBAcolor;
+        if (color) {
+          treeitem.style.backgroundColor = color;
+        }
         if (server.isSecure) {
           treeitem.classList.add("isSecure");
         }
         // For IM accounts, we can try to fetch a protocol specific icon.
diff --git a/mailnews/base/prefs/content/am-main.js b/mailnews/base/prefs/content/am-main.js
--- a/mailnews/base/prefs/content/am-main.js
+++ b/mailnews/base/prefs/content/am-main.js
@@ -59,9 +59,9 @@ function serverPrettyNameOnBlur(event) {
 
 function serverColorOnChange(event) {
   const row = parent.document.getElementById(gAccount.key);
   if (row) {
-    const color = document.getElementById("server.color").value;
+    const color = document.getElementById("serverColor").value;
     gAccount.incomingServer.color = color;
     row.style.backgroundColor = gAccount.incomingServer.RGBAcolor;
   }
 }
diff --git a/mailnews/base/prefs/content/am-main.xhtml b/mailnews/base/prefs/content/am-main.xhtml
--- a/mailnews/base/prefs/content/am-main.xhtml
+++ b/mailnews/base/prefs/content/am-main.xhtml
@@ -71,9 +71,16 @@
             for="serverColor"
             data-l10n-id="account-settings-color-label"
           />
           <div class="input-container">
-            <input id="serverColor" type="color" class="input-inline" />
+            <input
+              id="serverColor"
+              type="color"
+              wsm_persist="true"
+              class="input-inline"
+              onchange="serverColorOnChange(event);"
+              prefstring="mail.server.%serverkey%.color"
+            />
             <button
               id="resetColor"
               type="button"
               data-l10n-id="account-settings-reset-color-button"
diff --git a/mailnews/base/prefs/content/am-serverwithnoidentities.js b/mailnews/base/prefs/content/am-serverwithnoidentities.js
--- a/mailnews/base/prefs/content/am-serverwithnoidentities.js
+++ b/mailnews/base/prefs/content/am-serverwithnoidentities.js
@@ -103,9 +103,9 @@ function onSave() {
 
 function serverColorOnChange(event) {
   const row = parent.document.getElementById(gAccount.key);
   if (row) {
-    const color = document.getElementById("server.color").value;
+    const color = document.getElementById("serverColor").value;
     gAccount.incomingServer.color = color;
     row.style.backgroundColor = gAccount.incomingServer.RGBAcolor;
   }
 }
diff --git a/mailnews/base/prefs/content/am-serverwithnoidentities.xhtml b/mailnews/base/prefs/content/am-serverwithnoidentities.xhtml
--- a/mailnews/base/prefs/content/am-serverwithnoidentities.xhtml
+++ b/mailnews/base/prefs/content/am-serverwithnoidentities.xhtml
@@ -81,9 +81,16 @@
             for="serverColor"
             data-l10n-id="account-settings-color-label"
           />
           <div class="input-container">
-            <input id="serverColor" type="color" class="input-inline" />
+            <input
+              id="serverColor"
+              type="color"
+              wsm_persist="true"
+              class="input-inline"
+              onchange="serverColorOnChange(event);"
+              prefstring="mail.server.%serverkey%.color"
+            />
             <button
               id="resetColor"
               type="button"
               data-l10n-id="account-settings-reset-color-button"
diff --git a/mailnews/extensions/newsblog/am-newsblog.js b/mailnews/extensions/newsblog/am-newsblog.js
--- a/mailnews/extensions/newsblog/am-newsblog.js
+++ b/mailnews/extensions/newsblog/am-newsblog.js
@@ -79,9 +79,9 @@ function serverPrettyNameOnBlur(event) {
 
 function serverColorOnChange(event) {
   let row = parent.document.getElementById(gAccount.key);
   if (row) {
-    let color = document.getElementById("server.color").value;
+    let color = document.getElementById("serverColor").value;
     gAccount.incomingServer.color = color;
     row.style.backgroundColor = gAccount.incomingServer.RGBAcolor;
   }
 }
diff --git a/mailnews/extensions/newsblog/am-newsblog.xhtml b/mailnews/extensions/newsblog/am-newsblog.xhtml
--- a/mailnews/extensions/newsblog/am-newsblog.xhtml
+++ b/mailnews/extensions/newsblog/am-newsblog.xhtml
@@ -88,9 +88,16 @@
             for="serverColor"
             data-l10n-id="account-settings-color-label"
           />
           <div class="input-container">
-            <input id="serverColor" type="color" class="input-inline" />
+            <input
+              id="serverColor"
+              type="color"
+              wsm_persist="true"
+              class="input-inline"
+              onchange="serverColorOnChange(event);"
+              prefstring="mail.server.%serverkey%.color"
+            />
             <button
               id="resetColor"
               type="button"
               data-l10n-id="account-settings-reset-color-button"
