# HG changeset patch
# User Betterbird <betterbird@betterbird.eu>
# Date 1711902452 -7200
# Parent  fa4ee7f15e4ccd82dc18d38a54fe7ff53dfc5f4f
Feature: Account colours, part 3: Compose window.

diff --git a/mail/components/compose/content/MsgComposeCommands.js b/mail/components/compose/content/MsgComposeCommands.js
--- a/mail/components/compose/content/MsgComposeCommands.js
+++ b/mail/components/compose/content/MsgComposeCommands.js
@@ -7834,8 +7834,12 @@ function FillIdentityList(menulist) {
         account.incomingServer.prettyName
       );
       item.setAttribute("identitykey", identity.key);
       item.setAttribute("accountkey", account.key);
+      const color = account.incomingServer.RGBAcolor;
+      if (color) {
+        item.style.backgroundColor = color;
+      }
       if (i == 0) {
         // Mark the first identity as default.
         item.setAttribute("default", "true");
       }
@@ -9566,8 +9570,14 @@ function LoadIdentity(startup) {
     params.accountKey = accountKey;
     input.searchParam = JSON.stringify(params);
   }
 
+  if (accountKey) {
+    const color =
+      MailServices.accounts.getAccount(accountKey).incomingServer.RGBAcolor;
+    identityElement.style.backgroundColor = color;
+  }
+
   if (startup) {
     // During compose startup, bail out here.
     return;
   }
diff --git a/mail/themes/shared/mail/messengercompose.css b/mail/themes/shared/mail/messengercompose.css
--- a/mail/themes/shared/mail/messengercompose.css
+++ b/mail/themes/shared/mail/messengercompose.css
@@ -871,9 +871,10 @@ toolbarbutton.formatting-button {
   height: 14px;
 }
 
 #msgIdentityPopup >  menuitem[selected="true"] {
-  background-color: var(--autocomplete-popup-highlight-background);
+  /* Don't let the account color override the background */
+  background-color: var(--autocomplete-popup-highlight-background) !important;
   color: var(--autocomplete-popup-highlight-color);
 }
 
 #msgSubjectContainer {
